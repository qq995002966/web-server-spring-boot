var F_GameSummary_Entrance={_init:function(a){if(B_Login._checkUpdate(),M_HeadFoot._headShow(2),M_Dom._menuList("游戏详情","7-1"),B_User._isDemoUser())B_Login._openLogin("background");else{M_Init._clean();var e=B_Common._getUrl("query");e.g?(M_Init._gameDetailId=e.g,B_Game._setLast(M_Init._gameDetailId,"outsideGameDetail")):a?(M_Init._gameDetailId=a,B_Game._setLast(M_Init._gameDetailId,"outsideGameDetail")):M_Init._gameDetailId||(M_Init._gameDetailId=M_Init._getGameId("outsideGameDetail")),M_Game._checkGameVisitList("gameSummary")}}},F_GameSummary_Info={_chartClick:function(a,e){var t={};switch(a){case"bs_emotion":switch(e.type){case"正面反馈":t.classifySentiment=1;break;case"负面反馈":t.classifySentiment=-1}t.dateBegin=e.date,t.dateEnd=e.date,M_Outside._redirectForum(t)}},_domInit:function(){var a="";a+='<div class="blockpart  col-lg-8 col-md-12 col-sm-12 col-xs-12 widthLarge-b ">',a+="<h3>游戏简介</h3>",a+='<div class="boxshadow yuqing-search-result yu-my-game game-summary gs-heigh no-pointer">',a+="</div></div>",a+='<div class="blockpart col-lg-4 col-md-12 col-sm-12 col-xs-12 widthLarge-b">',a+="<h3>竞品推荐</h3>",a+='<div class="boxshadow yu-my-game game-summary-recommend gs-heigh">',a+="</div></div>",a+='<div class="blockpart col-lg-8 col-md-12 col-sm-12 col-xs-12 ">',a+="<h3>玩家情感概览</h3>",a+='<div class="boxshadow gs-height-a">',a+='<div class="tg-selected-drop tg-date-fl">',a+="<span>日期</span>",a+='<p class="tg-drop-text-part"><i class="tg-graph tg-triangle-gray-bottom"></i><span class="hot-area" id="dc1"></span><input id="db1" type="hidden" value=""><input id="de1" type="hidden" value=""></p></div>',a+='<div id="bs_emotion" style="width: 100%; height: 86%"></div>',a+="</div></div>",a+='<div class="blockpart  col-lg-4 col-md-12 col-sm-12 col-xs-12  ">',a+="<h3>舆情热力图</h3>",a+='<div class="boxshadow gs-height-a">',a+='<div id="bs_radar" style="width: 100%; height: 100%"></div>',a+="</div></div>",a+='<div class="blockpart tg-table-layout col-lg-12 col-md-12 col-sm-12 col-xs-12  ">',a+="<h3>榜单排名</h3>",a+='<div class="boxshadow tg-table-content gs-height-b">',a+='<ul class="tg-tab-change-block" id="bs_rank_tab">',a+='<li class="tg-tab-block-active">ThinkingGame舆情榜</li>',a+="</ul>",a+='<div id="bs_rank_select">',a+='<div class="tg-selected-drop tg-date-fl">',a+="<span>日期</span>",a+='<p class="tg-drop-text-part"><i class="tg-graph tg-triangle-gray-bottom"></i><span class="hot-area" id="dc2"></span><input id="db2" type="hidden" value=""><input id="de2" type="hidden" value=""></p></div>',a+="</div>",a+='<div id="bs_ranklist" style="width: 100%; height: 70%"></div>',a+="</div></div>",a+='<div class="blockpart  col-lg-12 col-md-12 col-sm-12 col-xs-12 channel-infor b_none">',a+="<h3>渠道信息</h3>",a+='<div id="bs_channel">',a+="</div></div>",$("#ct_main_area").html(a),B_Date._chooseSection({autoCommit:!0,todayValid:!1},1,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(a,e){a==M_Init._dateCache.begin&&M_Init._dateCache.end==e||(M_Init._dateCache.begin=a,M_Init._dateCache.end=e,F_GameSummary_Info._getEmotion())}),B_Date._chooseSection({autoCommit:!0,todayValid:!1},2,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(a,e){a==M_Init._dateCache.begin2&&M_Init._dateCache.end2==e||(M_Init._dateCache.begin2=a,M_Init._dateCache.end2=e,F_GameSummary_Info._getRankProperty())}),B_Game._getCollect(function(){F_GameSummary_Info._getInfo()})},_getRankProperty:function(){if("undefined"==typeof M_Init._dataCache.rankTabSelect&&(M_Init._dataCache.rankTabSelect=0),"S"!=M_Game._gameInfo[3]||M_Init._dataCache.rankTabHased)F_GameSummary_Info._getRankList();else{var a=$("#bs_ranklist"),e={};e.project_id=M_Init._gameDetailId,e=B_Common._postData(e),B_Port._ajax("appstoreClassify","get",!0,e,function(){a.html(B_Pre._loading())},function(){a.html("")},function(a,e){if(a.device_type_dim&&a.device_type_dim.length>0){M_Init._dataCache.rankTabHased=!0,$("#bs_rank_tab").append("<li>AppStore排行榜</li>");var t=[];M_Init._dataCache.listType=a.list_type_dim[0];for(var _=0;_<a.list_type_dim.length;_++)t.push({id:a.list_type_dim[_],name:M_Game._appListType[a.list_type_dim[_]]});$("#bs_rank_select").prepend(F_GameSummary_Info._htmlRankSelect("bs_rank_select_list","榜单",t)),t=[],M_Init._dataCache.gameType=a.game_type_dim[0];for(var _=0;_<a.game_type_dim.length;_++)t.push({id:a.game_type_dim[_],name:M_Game._appGameType[a.game_type_dim[_]]});$("#bs_rank_select").prepend(F_GameSummary_Info._htmlRankSelect("bs_rank_select_type","类型",t)),t=[],M_Init._dataCache.deviceType=a.device_type_dim[0];for(var _=0;_<a.device_type_dim.length;_++)t.push({id:a.device_type_dim[_],name:M_Game._appPlatType[a.device_type_dim[_]]});$("#bs_rank_select").prepend(F_GameSummary_Info._htmlRankSelect("bs_rank_select_plat","设备",t)),$("#bs_rank_tab li").each(function(a){$(this).click(function(){if(!$(this).hasClass("tg-tab-block-active")){switch($(this).addClass("tg-tab-block-active").siblings().removeClass("tg-tab-block-active"),a+""){case"0":M_Init._dataCache.rankTabSelect=0,$(".bs_rank_select_list").hide(),$(".bs_rank_select_type").hide(),$(".bs_rank_select_plat").hide();break;case"1":M_Init._dataCache.rankTabSelect=1,$(".bs_rank_select_list").show(),$(".bs_rank_select_type").show(),$(".bs_rank_select_plat").show()}F_GameSummary_Info._getRankList()}})}),M_Inside._dropShow(),M_Inside._dropLeave(),M_Inside._dropSelected(function(a){M_Init._dataCache.listType=a,F_GameSummary_Info._getRankList()},"bs_rank_select_list"),M_Inside._dropSelected(function(a){M_Init._dataCache.gameType=a,F_GameSummary_Info._getRankList()},"bs_rank_select_type"),M_Inside._dropSelected(function(a){M_Init._dataCache.deviceType=a,F_GameSummary_Info._getRankList()},"bs_rank_select_plat"),F_GameSummary_Info._getRankList()}else F_GameSummary_Info._getRankList()},function(e,t,_){a.html(B_Pre._empty(t))})}},_htmlRankSelect:function(a,e,t){var _='<div class="tg-selected-drop tg-date-fl '+a+'" style="display: none">';_+="<span>"+e+"</span>",_+='<div class="tg-selected-drop"><p class="tg-drop-text-part">',_+='<i class="tg-graph tg-triangle-gray-bottom"></i><span id="tabSelect" data-i="'+t[0].id+'">'+t[0].name+"</span>",_+="</p>",_+='<ul style="display: none;">';for(var i=0;i<t.length;i++)_+='<li><a data-i="'+t[i].id+'">'+t[i].name+"</a></li>";return _+="</ul></div></div>"},_getRankList:function(){var a=$("#bs_ranklist");M_Init._dataCache.project=M_Init._dataCache.app=[];var e={};e.project_id=M_Init._gameDetailId,e.app_type=M_Init._dataCache.gameType?M_Init._dataCache.gameType:0,e.list_type=M_Init._dataCache.listType?M_Init._dataCache.listType:0,e.device_type=M_Init._dataCache.deviceType?M_Init._dataCache.deviceType:0,e.start_date=M_Init._dateCache.begin2,e.end_date=M_Init._dateCache.end2,e=B_Common._postData(e),B_Port._ajax("reputationIntroduceOpinion","get",!0,e,function(){a.html(B_Pre._loading())},function(){a.html("")},function(e,t){e?(M_Init._dataCache.project=e.project_rank&&e.project_rank.length>0?e.project_rank:[],M_Init._dataCache.app=e.app_store&&e.app_store.length>0?e.app_store:[],F_GameSummary_Info._chartRank()):a.html(B_Pre._empty("暂无数据"))},function(e,t,_){a.html(B_Pre._empty(t))})},_chartRank:function(){var a={x_axis:[],y_axis:[],xFormatDate:!0,yFormat:"",legendSelectMode:!1,inverse:!0,yMin:1,yMax:0},e="";switch(M_Init._dataCache.rankTabSelect+""){case"0":a.y_axis.push({name:"舆情排行榜",data:[]}),e=M_Init._dataCache.project;break;case"1":a.y_axis.push({name:"AppStore排行榜",data:[]}),e=M_Init._dataCache.app}for(var t=[],_=0;_<e.length;_++)a.x_axis.push(e[_].data_date),a.yMax=a.yMax>parseInt(e[_].rank)?a.yMax:parseInt(e[_].rank),t.push(e[_].rank);a.yMax=a.yMax<5?5:0,a.y_axis[0].data=t,M_Outside_Chart._chartData("line","bs_ranklist",a)},_getEmotion:function(){var a=$("#bs_emotion"),e={};e.start_date=M_Init._dateCache.begin,e.end_date=M_Init._dateCache.end,e.project_id=M_Init._gameDetailId,e=B_Common._postData(e),B_Port._ajax("reputationIntroduceFeedback","get",!0,e,function(){a.html(B_Pre._loading())},function(){a.html("")},function(e,t){if(e&&e.length>0){for(var _={x_axis:[],y_axis:[],xFormatDate:!0,yFormat:"",legendSelectMode:!0},i=[],n=[],s=0;s<e.length;s++)_.x_axis.push(e[s].data_date),i.push(e[s].positive_num),n.push(e[s].negative_num);_.y_axis.push({name:"正面反馈",data:i}),_.y_axis.push({name:"负面反馈",data:n}),M_Outside_Chart._chartData("lineSum","bs_emotion",_)}else a.html(B_Pre._empty("暂无数据"))},function(e,t,_){a.html(B_Pre._empty(t))})},_getInfo:function(){infoTimeOut="",clearTimeout(infoTimeOut),infoTimeOut=setTimeout(function(){F_GameSummary_Info._getInfoPort()},300)},_getInfoPort:function(){var a=$(".game-summary"),e=$(".game-summary-recommend"),t=$("#bs_radar"),_=$("#bs_channel"),i={};i.project_id=M_Init._gameDetailId,i=B_Common._postData(i),B_Port._ajax("reputationIntroduce","get",!0,i,function(){a.html(B_Pre._loading()),e.html(B_Pre._loading()),t.html(B_Pre._loading()),_.html(B_Pre._loading())},function(){a.html(""),e.html(""),t.html(""),_.html("")},function(t,i){t.game_info&&(a.html(F_GameSummary_Info._htmlBase(t.game_info)),e.html(F_GameSummary_Info._htmlCompete(t.competing_list)),t.channel_info&&t.channel_info.length>0?($(".channel-infor").show(""),_.html(F_GameSummary_Info._htmlChannel(t.channel_info))):$(".channel-infor").remove(),t.radar_data&&F_GameSummary_Info._chartRadar(t.radar_data),$("#bs_add_game").click(function(){B_Game._checkCollect(M_Init._gameDetailId)?B_Pop._init("confirm",{skin:"layerCheck-class",content:"确实要取消添加【"+M_Game._gameInfo[1]+"】么？",btn:["确认","取消"],title:"操作提示"},function(){B_Pop._init("close"),B_Game._setCollect(M_Init._gameDetailId,"bs_add_game",{on:["tg-assist-btn","取消添加"],off:["tg-main-btn","添加游戏"]})},function(){B_Pop._init("close")}):B_Game._setCollect(M_Init._gameDetailId,"bs_add_game",{on:["tg-assist-btn","取消添加"],off:["tg-main-btn","添加游戏"]})}),$("#bs_atlas_game").click(function(){M_Outside._redirectAtlas(M_Init._gameDetailId)}),$("#bs_base_redirect li").each(function(a){$(this).click(function(){switch(a+""){case"0":var e=$(this).attr("data-i");e=parseInt(e),e=Math.ceil(e/B_Page._size),B_Jump._go("base",B_Jump._getUrl("outsideRankSentiment")+"p="+e+"&t="+B_Common._encodeUrl(M_Game._gameInfo[5]));break;case"1":M_Outside._redirectForum({gameId:M_Init._gameDetailId});break;case"2":M_Outside._redirectForum({gameId:M_Init._gameDetailId,classifySentiment:1});break;case"3":M_Outside._redirectForum({gameId:M_Init._gameDetailId,classifySentiment:-1});break;case"4":M_Outside._redirectComments({gameId:M_Init._gameDetailId});break;case"5":M_Outside._redirectComments({gameId:M_Init._gameDetailId,ratingStageList:1});break;case"6":M_Outside._redirectComments({gameId:M_Init._gameDetailId,ratingStageList:-1})}})}))},function(i,n,s){a.html(B_Pre._empty(n)),e.html(B_Pre._empty(n)),t.html(B_Pre._empty(n)),_.html(B_Pre._empty(n))})},_chartRadar:function(a){var e={"正向反馈占比":"negative_weight","讨论热度":"post_weight","舆论稳定度":"stable_weight","有效反馈占比":"useless_weight","活跃人数":"user_weight","畅销排名":"appstore_weight"},t={indicator:[],data:{"当前游戏":[]},legendSelectMode:!0,color:["#3daae3","#2ed383"]};$.each(e,function(e,_){"畅销排名"==e?a.avg[_]&&(t.indicator.push({text:e,max:100}),t.data["当前游戏"].push(a.real[_]?(100*a.real[_]).toFixed(0):0)):(t.indicator.push({text:e,max:100}),t.data["当前游戏"].push(a.real[_]?(100*a.real[_]).toFixed(0):0))}),t.indicator&&t.indicator.length>0&&$("#bs_radar").length>0&&M_Outside_Chart._chartData("radar","bs_radar",t)},_searchChannel:function(a){M_Outside._redirectComments({gameId:M_Init._gameDetailId,channelId:a})},_htmlChannel:function(a){for(var e="",t=0;t<a.length;t++)e+='<div class="boxshadow"><img src="'+B_Game._imgSourceUrl(a[t].source_type,"small")+'">',e+='<ul class="channel-card-list">',e+="<li><span>评分</span>",e+="<span>"+a[t].rating_value+"</span>",e+="</li>",e+="<li><span>评价量</span>",e+="<span><a onclick=\"F_GameSummary_Info._searchChannel('"+a[t].source_type+"')\">"+a[t].rating_count+"</a></span>",e+="</li>",e+="<li><span>版本号</span>",e+="<span>"+a[t].version+"</span>",e+="</li>",e+="<li><span>下载量</span>",e+="<span>"+a[t].download_num+"</span>",e+="</li>",e+="<li><span>更新时间</span>",e+="<span>"+a[t].update_date+"</span>",e+="</li>",e+="</ul></div>";return e},_htmlCompete:function(a){var e="",t=[];if(a&&a.length>0){for(var _=0;_<a.length;_++)t.push(a[_].project_id);e+='<ul class="game-list">';for(var i=B_Game._getGame(t,5),_=0;_<a.length;_++)if(i[a[_].project_id]){if(e+='<li><div class="fl">',e+='<img src="'+i[a[_].project_id][0]+'" alt="'+i[a[_].project_id][1]+'" onclick="M_Outside._redirectLight('+a[_].project_id+')"><p onclick="M_Outside._redirectLight('+a[_].project_id+')">'+i[a[_].project_id][1]+"</p>",e+='<ul class="tg-tab-btn">',a[_].project_tags)for(var n=B_Game._tag(a[_].project_tags),s=0;s<a[_].project_tags.length;s++)n[a[_].project_tags[s]]&&(e+='<li class="tg-tab-btn-normal" onclick="M_Outside._redirectCenter(\''+B_Common._encodeUrl(n[a[_].project_tags[s]])+"');\">"+n[a[_].project_tags[s]]+"</li>");e+="</div>",e+='<ul class="fr"><li>',e+='<span><b class="color-blue">'+a[_].tg_rank+"</b></span><p>舆情榜排名</p>",e+="</li></ul>",e+="</li>"}e+="</ul>"}return e},_htmlBase:function(a){var e="";if(e+='<ul class="game-list">',e+='<li><div class="fl">',e+='<img src="'+M_Game._gameInfo[0]+'" alt="'+M_Game._gameInfo[1]+'">',e+="<p>"+M_Game._gameInfo[1]+"</p>",e+="<span>游戏类型："+M_Game._gameInfo[4]+"</span>",e+="<span>开发商："+M_Game._gameInfo[2]+"</span>",e+="<span>发行商："+a.distributor+"</span>",e+="<span>发行日期："+a.release_date+"</span>",e+='<ul class="tg-tab-btn">',a.tag_list)for(var t=B_Game._tag(a.tag_list),_=0;_<a.tag_list.length;_++)t[a.tag_list[_]]&&(e+='<li class="tg-tab-btn-normal" onclick="M_Outside._redirectCenter(\''+B_Common._encodeUrl(t[a.tag_list[_]])+"');\">"+t[a.tag_list[_]]+"</li>");return e+="</ul>",e+='<div class="operation-btn">',e+=B_Game._checkCollect(M_Init._gameDetailId)?'<button class="tg-assist-btn" id="bs_add_game">取消添加</button>':'<button class="tg-main-btn" id="bs_add_game">添加为关注</button>',e+="</div>",e+="</div></li>",e+="<li><h5>基本信息</h5>",e+="<p>"+a.overview+"</p></li>",e+="<li>",e+=' <ul class="tg-tab-change-block" id="bs_base_redirect">',e+='<li data-i="'+a.hot_rank+'">',e+='<b class="color-1">'+a.hot_rank+"</b><p>ThinkingGame 舆情榜</p><span>较昨日  ",a.hot_rank=parseInt(a.hot_rank),a.hot_rank_yesterday=parseInt(a.hot_rank_yesterday),e+=a.hot_rank>a.hot_rank_yesterday?'<b class="down">↓</b>'+(a.hot_rank_yesterday-a.hot_rank)+"名":a.hot_rank<a.hot_rank_yesterday?'<b class="up">↑</b>'+(a.hot_rank_yesterday-a.hot_rank)+"名":"<b>→</b>",e+="</span>",e+="</li>",e+="<li>",e+='<b class="color-2">'+a.title_num+"</b><p>近30天论坛帖子总量</p>",e+=this._htmlArrow(a.title_num_growth),e+="</li>",e+="<li>",e+='<b class="color-3">'+a.positive_num+"</b><p>近30天论坛正面情感贴</p>",e+=this._htmlArrow(a.positive_num_growth),e+="</li>",e+="<li>",e+='<b class="color-4">'+a.negative_num_num+"</b><p>近30天论坛负面情感贴</p>",e+=this._htmlArrow(a.negative_num_growth),e+="</li>","S"==M_Game._gameInfo[3]&&("undefined"!=typeof a.channel_total&&(e+="<li>",e+='<b class="color-5">'+a.channel_total+"</b><p>近30天渠道评价总览</p>",e+=this._htmlArrow(a.channel_total_growth),e+="</li>"),"undefined"!=typeof a.channel_positive&&(e+="<li>",e+='<b class="color-6">'+a.channel_positive+"</b><p>近30天渠道正面评论</p>",e+=this._htmlArrow(a.channel_positive_growth),e+="</li>"),"undefined"!=typeof a.channel_negative&&(e+="<li>",e+='<b class="color-7">'+a.channel_negative+"</b><p>近30天渠道负面评论</p>",e+=this._htmlArrow(a.channel_negative_growth),e+="</li>")),e+="</ul></li>",e+="</ul>"},_htmlArrow:function(a){var e="<span>较前一周期";return a>0?e+='<b class="up">↑</b>'+a:a<0?(a=Math.abs(a),e+='<b class="up">↓</b>'+a):e+='<b class="up">→</b>'+a,e+="%</span>"}};