require(["frontmain"],function(){require(["jquery","layer","base","front","store.min","particles","jquery.panzoom","app/outside"],function(){store=require("store.min"),F_Atlas_Entrance._init()})});var F_Atlas_Entrance={_gameId:0,_buff:{},_dataCache:{},_init:function(){B_Login._check(),S_HeadFoot._getHead();var t=B_Common._getUrl("query");t.g&&!isNaN(t.g)?(F_Atlas_Entrance._gameId=t.g,B_Game._setLast(F_Atlas_Entrance._gameId,"outsideAtlas")):F_Atlas_Entrance._gameId=B_Game._getLast("outsideAtlas"),B_Game._getCollect(function(){F_Atlas_Info._getInfo(),F_draw._init()}),F_Atlas_Favorite._getData()}},F_draw={_init:function(){var t=$("#Wrap"),a=t.find("#canvas").panzoom({contain:!0});a.parent().on("mousewheel.focal",function(t){t.preventDefault();var e=t.delta||t.originalEvent.wheelDelta,l=e?e<0:t.originalEvent.deltaY>0;a.panzoom("zoom",l,{increment:.1,animate:!1,focal:t})})},_line:function(t,a,e,l,i){var c=t-e,n=a-l,o=Math.sqrt(c*c+n*n),s=(t+e)/2,r=(a+l)/2,_=s-o/2,h=r,d=Math.PI-Math.atan2(-n,c),g="width: "+o+"px; height: 1px; -moz-transform: rotate("+d+"rad); -webkit-transform: rotate("+d+"rad); -o-transform: rotate("+d+"rad); -ms-transform: rotate("+d+"rad); top: "+h+"px; left: "+_+"px; ",p='<div class="line" style="'+g+'"></div>';i?i.append(p):$("#canvas").append(p)},_arc:function(t,a,e,l){t.css({top:e-l,left:a-l,height:2*l,width:2*l})}},config={fontFamily:"Calibri",fps:60,box:20,animationTime:1e3,center:{radius:60,borderColor:"#FFFFFF",borderWidth:1,fill:"#404c58",font:{text:"center",size:16,color:"rgb(255,255,255)"}},child:{radius:35,borderColor:"#FFFFFF",borderWidth:1,fill:"#404c58",distance:240,line:{color:"#f1f1f1",width:.5},font:{size:14,color:"#FFFFFF"},child:{radius:35,borderColor:"#FFFFFF",borderWidth:1,distance:240,fill:"#404c58",line:{color:"#f1f1f1",width:.5},font:{size:14,color:"#FFFFFF"},child:{radius:28,borderColor:"#FFFFFF",borderWidth:1,distance:220,fill:"#404c58",line:{color:"#f1f1f1",width:.5},font:{size:14,color:"#FFFFFF"}}}}},position={center:{origin:{x:null,y:null},current:{x:null,y:null}},child:[]},getWindowSize=function(){var t=document.getElementById("canvas");return{height:t.clientHeight,width:t.clientWidth}},F_Atlas_Info={_changeGame:function(t){t+""!=F_Atlas_Entrance._gameId+""&&(F_Atlas_Entrance._dataCache={},B_Game._setLast(t,"outsideAtlas"),F_Atlas_Entrance._gameId=t,F_Atlas_Info._getInfo(),F_draw._init())},_goLight:function(t){if(B_User._isDemoUser())B_Login._openLogin("l_"+t);else if(B_Game._checkAuthGame(t)){var a=B_Jump._getUrl("gameLight",{gameId:t});B_Jump._go("openUrl",a)}else B_Login._openProbation("game&gameId="+t)},_goAtlas:function(t){var a=B_Jump._getUrl("atlas");B_Jump._go("base",a+"?g="+t)},_search:function(t){B_Jump._go("openUrl",B_Jump._getUrl("search")+"?k="+B_Common._encodeUrl(t))},_getInfo:function(){if(F_Atlas_Entrance._dataCache.data&&F_Atlas_Entrance._dataCache.tag)F_Atlas_Info._htmlFormat(F_Atlas_Entrance._dataCache.data,F_Atlas_Entrance._dataCache.tag);else{var t=$("#canvas"),a={};a.project_id=F_Atlas_Entrance._gameId,a=B_Common._postData(a),B_Port._ajax("atlasProjectGraphList","get",!0,a,function(){t.html(B_Pre._loading())},function(){t.html("")},function(t,a){t&&!B_Common._checkObjectIsEmpty(t)&&(F_Atlas_Entrance._dataCache.data=t.child,F_Atlas_Entrance._dataCache.tag=t.tag_list,F_Atlas_Info._htmlFormat(t.child,t.tag_list))},function(a,e,l){t.html(B_Pre._empty(e))})}},_htmlFormat:function(t,a){var e=[],l=[];$.each(t,function(t,a){var i={tag_list:a.tag_list,gameId:a.project_id,text:B_Game._getGame([a.project_id],1)[a.project_id][1],ralationship:a.relation_name,image:B_Game._imgUrl(a.project_id),child:[]};if(a.relate_project&&a.relate_project.length>0)for(var c=0;c<a.relate_project.length;c++)if(i.child.push({tag_list:a.relate_project[c].tag_list,gameId:a.relate_project[c].project_id,text:B_Game._getGame([a.relate_project[c].project_id],1)[a.relate_project[c].project_id][1],ralationship:a.relate_project[c].relation_name,image:B_Game._imgUrl(a.relate_project[c].project_id),child:[]}),a.relate_project[c].relate_project&&a.relate_project[c].relate_project.length>0)for(var n=0;n<a.relate_project[c].relate_project.length&&!(n>1);n++)l=B_Game._getGame([a.relate_project[c].relate_project[n].project_id],1),i.child[c].child.push({tag_list:a.relate_project[c].relate_project[n].tag_list,gameId:a.relate_project[c].relate_project[n].project_id,text:l&&l[a.relate_project[c].relate_project[n].project_id]&&l[a.relate_project[c].relate_project[n].project_id][1]?l[a.relate_project[c].relate_project[n].project_id][1]:"",ralationship:a.relate_project[c].relate_project[n].relation_name,image:B_Game._imgUrl(a.relate_project[c].relate_project[n].project_id)});e.push(i)}),F_Atlas_Info._htmlCenter(a),F_Atlas_Info._htmlDraw(e),$(".relationship-text").hover(function(){$(".ball-scale-multiple").css("opacity","0"),$(this).next(".ball-scale-multiple").css("opacity","1"),$(this).addClass("animated pulse relationship-text-hover"),$(this).next().next(".line").addClass("line-change-color")}),$(".relationship-text").mouseleave(function(){$(".ball-scale-multiple").css("opacity","0"),$(this).removeClass("animated pulse relationship-text-hover"),$(this).next().next(".line").removeClass("line-change-color")}),$(".child2-rt").hover(function(){$(".child2-ball").css("opacity","0"),$(this).next(".child2-ball").css("opacity","1"),$(this).addClass("animated pulse relationship-text-hover"),$(this).next().next(".line").addClass("line-change-color")}),$(".child2-rt").mouseleave(function(){$(".child2-ball").css("opacity","0"),$(this).removeClass("animated pulse relationship-text-hover"),$(this).next().next(".line").removeClass("line-change-color")}),$(".child3-rt").hover(function(){$(".child3-ball").css("opacity","0"),$(this).next(".child3-ball").css("opacity","1"),$(this).addClass("animated pulse relationship-text-hover"),$(this).next().next(".line").addClass("line-change-color")}),$(".child3-rt").mouseleave(function(){$(".child3-ball").css("opacity","0"),$(this).removeClass("animated pulse relationship-text-hover"),$(this).next().next(".line").removeClass("line-change-color")}),$(".child-pic").hover(function(){if($(this).parent().hasClass("child2"))var t="child-2-"+$(this).parents(".child1").attr("class").slice(25)+$(this).parent().attr("class").slice(25);else var t=$(this).parent().attr("class").slice(17);$("."+t+"text").css("display","block"),$(this).parent().children(".line, .arc").css({transition:"all  0.8s ease-in-out",display:"block"})})},_htmlCenter:function(t){var a="",e=F_Atlas_Info._htmlTag(F_Atlas_Entrance._gameId,t);a+='<div class="pop" data-i="'+F_Atlas_Entrance._gameId+'">',a+='<ul class="inner-circle">',a+='<li><a onclick="F_Atlas_Info._changeGame('+F_Atlas_Entrance._gameId+');">查看图谱</a></li>',a+='<li><a onclick="F_Atlas_Info._goLight('+F_Atlas_Entrance._gameId+');">灯塔透视</a></li>',a+="</ul>",a+='<ul class="style-list" id="tag'+F_Atlas_Entrance._gameId+'">'+e,a+="</ul>",a+="</div>",$("#canvas").append('<div id="center" class="arc"><b class="img-title">'+B_Game._getGame([F_Atlas_Entrance._gameId],1)[F_Atlas_Entrance._gameId][1]+'</b><img src="'+B_Game._imgUrl(F_Atlas_Entrance._gameId)+'">'+a+"</div>");var l=$("#center");F_draw._arc(l,getWindowSize().width/2,getWindowSize().height/2,config.center.radius);var i=2*Math.PI/$("#center .circle-tag").length;$("#center .circle-tag").each(function(t,a){$(this).css({position:"absolute",left:83*Math.sin(i*t)+85,top:83*Math.cos(i*t)+85})})},_htmlDraw:function(t){for(var a=getWindowSize().width/2,e=getWindowSize().height/2,l=2*Math.PI/t.length,i=config.child.distance+config.center.radius,c=0;c<t.length;c++){var n=a+Math.sin(c*l)*i,o=a+Math.sin(c*l)*i/2,s=e+Math.cos(c*l)*i,r=e+Math.cos(c*l)*i/2,_=F_Atlas_Info._htmlGame(1,{tag:t[c].tag_list,one:c,two:"",image:t[c].image,title:t[c].text,gameId:t[c].gameId});$(_).appendTo("#canvas");var h=2*Math.PI/$(".child-1-"+c+"  .circle-tag").length;if($(".child-1-"+c+"  .circle-tag").each(function(t,a){$(this).css({position:"absolute",left:80*Math.sin(h*t)+85,top:80*Math.cos(h*t)+85})}),$("#canvas").append('<p class="relationship-text" style="top:'+r+"px;left:"+o+'px" onclick="F_Atlas_Info._search(\''+t[c].ralationship+"')\">"+t[c].ralationship+"</p>"),$("#canvas").append('<div class="ball-scale-multiple" style="top:'+(e+Math.cos(c*l)*(i-80)/2)+"px;left:"+(a+Math.sin(c*l)*(i-80)/2)+'px"><div></div><div></div><div></div></div>'),F_draw._arc($(".child-1-"+c),n,s,config.child.radius),F_draw._line(a,e,n,s),t[c].child)for(var d=config.child.child.distance,g=0;g<t[c].child.length;g++){var p=2*Math.PI/t.length*(c-.8)+1.3*Math.PI/t.length*g,m=n+Math.sin(p)*d,f=n+Math.sin(p)*d/2,u=s+Math.cos(p)*d,v=s+Math.cos(p)*d/2,F=2*Math.PI/$(".child-1-"+c+">.child-2-"+g+"  .circle-tag").length;$(".child-2-"+g+"  .circle-tag").each(function(t,a){$(this).css({position:"absolute",left:80*Math.sin(F*t)+85,top:80*Math.cos(F*t)+85})});var I=F_Atlas_Info._htmlGame(2,{tag:t[c].child[g].tag_list,one:c,two:g,image:t[c].child[g].image,title:t[c].child[g].text,gameId:t[c].child[g].gameId});$(I).appendTo(".child-1-"+c);var F=2*Math.PI/$(".child-1-"+c+">.child-2-"+g+"  .circle-tag").length;if($(".child-1-"+c+">.child-2-"+g+"  .circle-tag").each(function(t,a){$(this).css({position:"absolute",left:80*Math.sin(F*t)+85,top:80*Math.cos(F*t)+85})}),F_draw._arc($(".child-1-"+c+">.child-2-"+g),m+32-n,u+32-s,config.child.child.radius),F_draw._line(36,36,m-n+36,u-s+36,$(".child-1-"+c)),$("#canvas").append('<p class="child2-rt child-1-'+c+'text" style="top:'+v+"px;left:"+f+'px" onclick="F_Atlas_Info._search(\''+t[c].child[g].ralationship+"')\">"+t[c].child[g].ralationship+"</p>"),$("#canvas").append('<div class="ball-scale-multiple child2-ball" style="top:'+(s+Math.cos(p)*(d+60)/2)+"px;left:"+(n+Math.sin(p)*(d+60)/2)+'px"><div></div><div></div><div></div></div>'),t[c].child[g].child)for(var A=config.child.child.child.distance,b=0;b<t[c].child[g].child.length;b++){var x=2*Math.PI/t.length*(c-1.3)+1*Math.PI/t.length*g+Math.PI/4/t[c].child[g].child.length*(b+.8),j=2*Math.PI/t.length*(c-1.15)+1*Math.PI/t.length*g+Math.PI/5.66/t[c].child[g].child.length*(b+.8),M=Math.sin(x)*A,C=(Math.sin(x),Math.cos(x)*A),B=(Math.cos(x),F_Atlas_Info._htmlGame(3,{tag:t[c].child[g].child[b].tag_list,one:c,two:b,image:t[c].child[g].child[b].image,title:t[c].child[g].child[b].text,gameId:t[c].child[g].child[b].gameId}));$(B).appendTo(".child-1-"+c+"> .child-2-"+g);var w=2*Math.PI/$(".child-1-"+c+"> .child-2-"+g+"> .child-3-"+b+"  .circle-tag").length;$(".child-1-"+c+"> .child-2-"+g+"> .child-3-"+b+"  .circle-tag").each(function(t,a){$(this).css({position:"absolute",left:80*Math.sin(w*t)+85,top:80*Math.cos(w*t)+85})}),F_draw._arc($(".child-1-"+c+"> .child-2-"+g+"> .child-3-"+b),M+32,C+32,config.child.child.child.radius),F_draw._line(36,36,M+36,C+36,$(".child-1-"+c+"> .child-2-"+g)),$("#canvas").append("<p onclick=\"F_Game._search('"+t[c].child[g].child[b].ralationship+'\')" class="child3-rt child-2-'+c+g+'text" style="top:'+(s+(Math.cos(p)+Math.cos(j))*(A+150)/2)+"px;left:"+(n+(Math.sin(p)+Math.sin(j))*(A+150)/2)+'px">'+t[c].child[g].child[b].ralationship+"</p>"),$("#canvas").append('<div class="ball-scale-multiple child3-ball" style="top:'+(s+(Math.cos(p)+Math.cos(j))*(A+180)/2)+"px;left:"+(n+(Math.sin(p)+Math.sin(j))*(A+180)/2)+'px"><div></div><div></div><div></div></div>')}}}},_htmlGame:function(t,a){var e="";switch(t+""){case"1":e+='<div class="arc child child1 child-1-'+a.one+'">',e+='<span class="game-pic child-pic">';break;case"2":e+='<div class="arc child child2 child-2-'+a.two+'">',e+='<span class="game-pic child2-pic child-pic">';break;case"3":e+='<div class="arc child child3 child-3-'+a.two+'">',e+='<span class="game-pic child3-pic child-pic">'}var l=F_Atlas_Info._htmlTag(a.gameId,a.tag);return e+='<img src="'+a.image+'" />',e+="</span>",e+='<div class="pop" data-c="'+t+'" data-o="'+a.one+'" data-t="'+a.two+'" data-i="'+a.gameId+'">',e+='<ul class="inner-circle">',e+='<li><a onclick="F_Atlas_Info._changeGame('+a.gameId+');">查看图谱</a></li>',e+='<li><a onclick="F_Atlas_Info._goLight('+a.gameId+');">灯塔透视</a></li>',e+="</ul>",e+='<ul class="style-list" id="tag'+a.gameId+'">'+l,e+="</ul>",e+="</div>",e+='<b class="img-title">'+a.title+"</b>",e+="</div>"},_htmlTag:function(t,a){var e="";if(a&&a.length>0)for(var l=0;l<a.length;l++)a[l]=parseInt(a[l]);var i=B_Game._tag(a),c=B_Game._checkCollect(parseInt(t))?"collectOn":"collectOff";return e+='<li id="gmCollect'+t+'" class="circle-tag c_img collect '+c+'" onclick="B_Game._setCollect('+t+",'gmCollect"+t+"','collect')\"></li>",i&&$.each(i,function(t,a){e+='<li class="circle-tag"><a onclick="F_Atlas_Info._search(\''+a+"')\">"+a+"</a></li>"}),e}},F_Atlas_Favorite={_gameReload:"",_getData:function(){var t=$("#bs_favorit"),a={};a.project_id=F_Atlas_Entrance._gameId,a=B_Common._postData(a),B_Port._ajax("guessLike","get",!0,a,function(){t.html(B_Pre._loading())},function(){t.html("")},function(t,a){if(t&&t.get.length>0){for(var e=[],l=0;l<t.get.length;l++)e.push(t.get[l].project_id);F_Atlas_Entrance._buff.game=e,F_Atlas_Favorite._dataRank(),$(".bottom-right").click(function(){F_Atlas_Favorite._dataRank()})}},function(a,e,l){t.html(B_Pre._empty(e))})},_dataRank:function(){if(F_Atlas_Entrance._buff.game){var t=$("#bs_favorit"),a=B_Game._getGame(F_Atlas_Entrance._buff.game),e=F_Atlas_Entrance._buff.game.length;if(e>10){var l=e%10==0?e/10-1:Math.floor(e/10);l=Math.round(Math.random()*l),l==F_Atlas_Favorite._gameReload&&(l>0?l-=1:l+=1),F_Atlas_Favorite._gameReload=l,l*=10,t.html(F_Atlas_Favorite._html(a,l))}else t.html(F_Atlas_Favorite._html(a,0))}B_Tab._maskShow($(".bottompart ul li"),$(".bottompart ul li"),"liOn",$(".bottompart .lt_shade"))},_html:function(t,a){var e="",l=0,i=0;return $.each(t,function(t,c){if(i>=a){if(l<10){var n=c[1].length>15?c[1].substr(0,15)+".":c[1],o=c[2]?c[2].length>15?c[2].substr(0,15)+".":c[2]:"",s="lt_gmCtOff";B_Game._checkCollect(parseInt(t))&&(s="lt_gmCtOn"),e+='                        <li>                            <img src="'+c[0]+'" alt="'+c[1]+'">                            <span class="game-name">'+n+'</span>                            <span class="game-company">'+o+'</span>                            <div class="lt_shade" style="display: none;">                                <div id="forum_gmCollect'+t+'" onclick="B_Game._setCollect('+t+",'forum_gmCollect"+t+"','lt_gmCt')\" class=\"lt_gmCollect c_img "+s+'"></div>                                <a onclick="F_Atlas_Info._goLight('+t+')">查看灯塔&gt;</a>                                <a onclick="F_Atlas_Info._goAtlas('+t+')">查看图谱&gt;</a>                            </div>                        </li>'}l++}i++}),e}};