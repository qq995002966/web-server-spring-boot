var F_Chat_Entrance={_init:function(){B_Login._checkUpdate(),M_HeadFoot._headShow(2),M_Dom._menuList("舆情分析","3-1-4"),B_User._isDemoUser()?B_Login._openLogin("background"):(M_Init._clean(),B_Game._checkAuthChat()?(M_Game._htmlGameVisitHide("outsideChat"),F_Chat_Info._domInit(),$("#nt_qq_show").click(function(){B_Pop._init("close"),B_Pop._init("open",{type:2,scroll:!0,title:"如何导出QQ聊天记录",width:"950px",height:"600px",shift:2,content:B_Jump._getUrl("notices")+"?t=chat"},"")}),F_Chat_Common._upload("#tk_upload_btn"),F_Chat_Info._getList(1)):($("#headerTop").html(""),M_Game._htmlGameVisitHide("outsideChat"),F_Chat_Info._domDemo()))}},F_Chat_Info={_domDemo:function(){var t='                    <img src="'+B_Common._cdnImgUrl()+'2.0/userlimit/talk.png" alt="" class="adver-bg">                    <div class="adver-des">                        <h3>聊天分析</h3>                        <p>基于自然语言处理技术，离线解析玩家QQ聊天记录，帮助项目组的运营人员在维护游戏的玩家官方群时，及时跟进玩家的讨论内容，正负面反馈和讨论话题。此外，聊天分析还能分析出活跃玩家的发言偏好，大大降低了运营人员的人力成本。</p>                        <button class="tg-main-btn" onclick="B_Jump._go(\'target\',\'login\')">登录后使用</button>                    </div>';$("#contentPart").html(t)},_domInit:function(){var t="";t+='            <div class="tg-table-layout blockpart col-lg-12 col-md-12 col-sm-12 col-xs-12 talk">                <h3>聊天分析任务</h3>                <div class="boxshadow tg-table-content" id="talk">                    <div class="tg-table-wrap tg-table-no-padding tg-height-hight">                        <div class="table-out-wrap" id="lt_item_list"></div>                        <ul class="tg-page-list" id="lt_forum_page"></ul>                    </div>                    <div class="up_progress b_none">                        <div class="up_percent">0%</div>                        <div class="up_progress-bar">                            <div class="qq"></div>                        </div>                        <div class="up_notice">正在上传中...</div>                    </div>                    <div class="tk_setup b_none">                        <div class="b_marginB30 tk_setup_title">请选择您希望解析聊天记录的时间段：</div>                        <div class="b_marginB20 b_relative tk_date_area">                            <i class="glyphicon glyphicon-calendar"></i>                            <span class="date-range b_borderRadius" id="dc1"></span>                            <input id="db1" type="hidden"><input id="de1" type="hidden">                        </div>                        <div class="tk_fast_choose b_marginB30">                            快速选择：　<span data-t="1">近一年</span>　|　<span data-t="2">近六月</span>　|　<span data-t="3">近三月</span>　|　<span data-t="4">近一月</span>　|　<span data-t="5">近一周</span>　|　<span data-t="6">今天</span>                        </div>                        <div class="text-center">                            <button type="button" class="tg-main-btn" id="btn_replace_confirm">确认</button>　<button type="button" class="tg-assist-btn" id="btn_replace_cancel">取消</button>                        </div>                    </div>                </div>            </div>',$("#headerTop").html('<span>提示：我们仅对聊天结果做分析和展示，不会截取任何隐私内容，请放心使用。<a id="nt_qq_show">如何导出QQ聊天记录？</a></span><button class="tg-main-btn" id="tk_upload_btn">上传QQ聊天记录</button>'),$("#mainContent").addClass("alert-task-part"),$("#ct_main_area").html(t)},_cache:{},_workDel:function(t){var n={};n.info_id=t,n=B_Common._postData(n),B_Port._ajax("talkDel","post",!0,n,function(){B_Pop._init("load",{type:1,time:10})},function(){B_Pop._init("close")},function(t,n){B_Pop._init("msg",{content:"删除成功"}),setTimeout(function(){F_Chat_Info._pageRefresh("del")},1e3)},function(t,n,o){B_Pop._init("alert",{content:B_Pre._empty(n)})})},_pageRefresh:function(t){var n=F_Chat_Info._cache.page;switch(t){case"del":F_Chat_Info._cache.total=F_Chat_Info._cache.total>0?F_Chat_Info._cache.total-1:0,n=Math.ceil(F_Chat_Info._cache.total/B_Page._size),n=F_Chat_Info._cache.page<=n?F_Chat_Info._cache.page:n}F_Chat_Info._getList(n)},_getList:function(t){F_Chat_Info._cache.page=t;var n=(t-1)*B_Page._size,o=$("#lt_item_list"),a=$("#lt_forum_page"),e={};e.index=n,e.limit=B_Page._size,e=B_Common._postData(e),B_Port._ajax("talkInfo","get",!0,e,function(){o.html(B_Pre._loading("b_padding30")),a.html("")},function(){o.html(""),a.html("")},function(e,_){e.get&&e.get.length>0?(o.html(F_Chat_Info._htmlList(e.get,n)),$(".bs_reupload").each(function(){var t=$(this).attr("data-i");F_Chat_Common._reUpload(t)}),F_Chat_Info._cache.total=e.total,a.html(B_Page._show({total:e.total,page:t},"number")),B_Page._click(t,function(t){F_Chat_Info._getList(t),B_Jump._top()})):o.html(B_Pre._empty("请上传聊天记录"))},function(t,n,a){o.html(B_Pre._empty(n))})},_htmlList:function(t,n){for(var o='<table class="tg-table table table-bordered">            <thead class="boxshadow">            <tr>            <th>来源</th>            <th>文件名</th>            <th>上传时间</th>            <th>解析状态</th>            <th>操作</th>        </tr></thead><tbody>',a=0;a<t.length;a++){var e=decodeURIComponent(t[a].file_name),_=[],i="<td></td>",s="";switch(t[a].source_type+""){case"10":s='<i class="tg-icon tg-talk-qq"></i>QQ'}var c='<button class="tg-main-btn" onclick="F_Chat_Common._openAdd('+t[a].info_id+",'"+e+"','"+t[a].start_date+"','"+t[a].end_date+"')\">解析设置</button>",l='<button class="tg-assist-btn" onclick="F_Chat_Common._delConfirm('+t[a].info_id+",'"+e+"')\">删除解析</button>";switch(t[a].status+""){case"-1":i='<td class="doc no-resolve"><span>未解析</span></td>',_.push('<button class="tg-main-btn" onclick="F_Chat_Common._openAdd('+t[a].info_id+",'"+e+"')\">开始解析</button>"),_.push(l);break;case"3":case"7":i='<td class="doc failed"><i class="tg-icon tg-talk-resolve"></i> <span>解析失败</span></td>',_.push('<button id="tk_reupload_btn_'+t[a].info_id+'" data-i="'+t[a].info_id+'" title="重新上传" class="tg-main-btn bs_reupload">重新上传</button>'),_.push(l);break;case"6":case"8":i='<td class="doc"><i class="tg-icon tg-talk-doc"></i> <a href="'+B_Jump._getUrl("outsideChatResult",{gameId:t[a].info_id})+'">查看分析报告</a></span></td>',_.push(c),_.push(l);break;default:i='<td class="doc resolving"><i class="tg-icon tg-talk-resolve"></i> <span>解析中..</span></td>',_.push('<button class="tg-main-btn" onclick="F_Chat_Info._pageRefresh()">更新状态</button>')}_=_.length>0?_.join("　"):"",o+="<tr>",o+="<td>"+s+"</td>",o+="<td>"+e+"</td>",o+="<td>"+t[a].dt_create_time+"</td>",o+=i,o+="<td>",o+=_,o+="</td></tr>"}return o+="</tbody></table>"}},F_Uploader={},F_Chat_Common={_uploadConstruct:function(t){var n={auto:!0,swf:"elements2.0/js/lib/Uploader.swf",server:"",accept:{title:"intoTypes",extensions:"txt,csv",mimeTypes:".txt,.csv"},pick:t,formData:{}};F_Uploader[t]=WebUploader.create(n)},_getParam:function(t,n,o){B_Port._ajax("ossChatPolicy","get",!1,n,function(){F_Chat_Common._progressShow()},null,function(n,a){if(!n)return B_Pop._init("msg",{content:"获取数据失败，请刷新重试！"}),!1;var e={};e.key=n.upload_file_name,e.policy=n.policy,e.OSSAccessKeyId=n.accessid,e.success_action_status="200",e.callback=n.callback,e.signature=n.signature,t.options.formData=e,t.options.server=n.host,F_Chat_Common._uploading(o)},function(t,n,o){return B_Pop._init("alert",{content:B_Pre._empty(n)}),!1})},_reUpload:function(t){F_Chat_Common._upload("#tk_reupload_btn_"+t,t)},_upload:function(t,n){var o=0;n&&(o=n),F_Chat_Common._uploadConstruct(t),F_Uploader[t].on("beforeFileQueued",function(n){if(B_User._isDemoUser())return B_Login._openLogin("background"),!1;if(0==n.size)return B_Pop._init("msg",{content:"不能上传空文件！"}),!1;if(n.size>=157286400)return B_Pop._init("msg",{content:"文件大小不能超过150M！"}),!1;var a={};a.file_name=n.name,a.info_id=o,a.source_type=10,a=B_Common._postData(a),F_Chat_Common._getParam(this,a,t)})},_uploading:function(t){F_Uploader[t].on("uploadSuccess",function(t,n){if(0!=n.return_code)return B_Pop._init("msg",{content:t.name+"上传失败！"+n.return_message}),!1;F_Chat_Info._pageRefresh()}).on("fileQueued",function(t){}).on("uploadError",function(t){B_Pop._init("msg",{content:t.name+"上传失败！"})}).on("uploadProgress",function(t,n){F_Chat_Common._progressing(100*n)}).on("uploadComplete",function(t){setTimeout(function(){F_Chat_Common._progressClose(),$(".layui-layer-shade").remove()},1e3),this.reset()})},_progressShow:function(){$(".up_progress-bar .qq").css({width:"0%"}),B_Pop._init("open",{type:1,shift:-1,title:!1,closeBtn:!1,shadeClose:!1,area:["auto","auto"],content:$(".up_progress")})},_progressing:function(t){t=(t+"").split(".")[0],$(".up_progress .up_percent").html(t+"%"),$(".up_progress-bar .qq").css({width:t+"%"})},_progressClose:function(){B_Pop._init("close")},_openAdd:function(t,n,o,a){B_Pop._init("close"),o=void 0===o?B_Date._getDiffDate("",-30):o.split(" ")[0],a=void 0===a?B_Date._getDiffDate("",0):a.split(" ")[0],B_Pop._init("open",{type:2,scroll:!0,title:"解析文件"+n,width:"630px",height:"450px",shift:2,content:"outsidechat_s.html?i="+t+"&b="+B_Common._encodeUrl(o)+"&e="+B_Common._encodeUrl(a)},"")},_delConfirm:function(t,n){B_Pop._init("confirm",{skin:"layerCheck-class",content:"确实要删除当前记录【"+n+"】么？",btn:["确认","取消"],title:"操作提示"},function(){F_Chat_Info._workDel(t)},function(){B_Pop._init("close")})}};