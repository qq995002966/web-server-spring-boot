requirejs.config({shim:{layer:["jquery"],"store.min":["jquery"],background:{deps:["base"]}},baseUrl:"elements2.0/js/lib",paths:{jquery:"./jquery-1.9.1.min",app:"../app",base:"../app/base",background:"../app/background"}}),require(["jquery","layer","store.min","base","background"],function(){if(store=require("store.min"),B_Login._checkUpdate(),B_User._isDemoUser())parent.B_Login._openLogin("background");else{$(".tg-assist-btn").click(function(){parent.B_Pop._init("close")});var t=B_Common._getUrl("query"),e=null,n="",i="",a="",o="2,3,4,5,6",s="",r=1,_=1;if(t.id){if(isNaN(t.id))return parent.B_Pop._init("msg",{content:"选择的数据不存在，请刷新页面重试"}),B_Pop._init("closeFrame"),!1;if(parent.F_Assistant_Info._cache.assistantData)for(var m=parent.F_Assistant_Info._cache.assistantData,c=0;c<m.length;c++)if(t.id==m[c].id){e=m[c].project_id,n=m[c].email_title,i=m[c].email_addr,a=m[c].keywords,o=m[c].send_day_of_week,s=m[c].send_hour_of_day,r=m[c].ignore_empty,_=m[c].status;break}}$('input[name="email_title"]').val(n),$('input[name="email_addr"]').val(i),$('input[name="keywords"]').val(a),$('input[name="ignore_empty"]').val(r),$('input[name="status"]').each(function(){$(this).val()==_+""?$(this).attr("checked",!0):$(this).attr("checked",!1)});for(var p='<div class="checkbox-wrap">',c=0;c<parent.F_Assistant_Common._init.week.length;c++)p+='<div class="tg-checkbox-btn"><input id="x'+c+'" type="checkbox" name="week"',o.indexOf(parent.F_Assistant_Common._init.week[c][1])>-1&&(p+=" checked "),p+='value="'+parent.F_Assistant_Common._init.week[c][1]+'"><label for="x'+c+'">'+parent.F_Assistant_Common._init.week[c][0]+"</label></div>";p+="</div>",$("#ft_send_week").append(p),p='<div class="checkbox-wrap">';var l=1;s=s?s.split(","):[];for(var c=0;c<parent.F_Assistant_Common._init.hour.length;c++)p+='<div class="tg-checkbox-btn"><input id="t'+c+'" type="checkbox" name="times"',p+=$.inArray(c+"",s)>-1?" checked ":"",p+='value="'+c+'"><label for="t'+c+'">'+parent.F_Assistant_Common._init.hour[c]+"</label></div>",p+=l%7==0?"<br>":"　",l++;p+='<div class="tg-checkbox-btn"><input id="a1" type="checkbox" name="chooseall"><label for="a1">全选/反选</label></div>',p+="</div>",$("#ft_send_hour").append(p),$('input[name="chooseall"]').click(function(){1==$(this).prop("checked")?$('input[name="times"]').each(function(){$(this).prop("checked",!0)}):$('input[name="times"]').each(function(){$(this).prop("checked",!1)})});var u=e;B_Game._dropChoose(e,"#gameDropChoose","edit",function(t){u=t}),$(".tg-main-btn").click(function(){var e=$.trim($('input[name="email_title"]').val()),n=$.trim($('input[name="email_addr"]').val()),i=[],a=$.trim($('input[name="keywords"]').val()),e=$.trim($('input[name="email_title"]').val()),o=B_Common._getCheckboxVal("week"),s=B_Common._getCheckboxVal("times"),r=$.trim($('input[name="ignore_empty"]').val()),_=B_Common._getRadioVal("status");if(!u||isNaN(u))return B_Pop._init("msg",{content:"请选择产品"}),!1;if(""==e)return B_Pop._init("msg",{content:"请填写任务名称"}),!1;if(""==n)return B_Pop._init("msg",{content:"请填写接收邮箱"}),!1;var m=!1;n=n.split(" ");for(var c=0;c<n.length;c++)""!=n[c]&&(B_Common._isMail(n[c])?i.push(n[c]):m=!0);if(m)return B_Pop._init("msg",{content:"请填写合法的接收邮箱"}),!1;if(""==a)return B_Pop._init("msg",{content:"请填写关注词汇"}),!1;for(var p=[],l=a.split(" "),c=0;c<l.length;c++)""!=l[c]&&p.push(l[c]);if(!(p&&p.length>0&&p.length<11))return B_Pop._init("msg",{content:"关注词汇最多允许添加10个词汇"}),!1;if(a=p.join(" "),i=n.join(" "),""==o)return B_Pop._init("msg",{content:"请选择发送日期"}),!1;if(""==s)return B_Pop._init("msg",{content:"请选择推送时间"}),!1;if(""==r||isNaN(r))return B_Pop._init("msg",{content:"请填写推送力度"}),!1;if(parseInt(r)<1)return B_Pop._init("msg",{content:"推送力度只允许为大于1的数字"}),!1;var d={};d.email_addr=i,d.email_title=e,d.status=_,d.keywords=a,d.send_day_of_week=o,d.send_hour_of_day=s,d.ignore_empty=r,d.project_id=u;var h="assistantAddQuery",f="添加成功";t.id&&(f="更新成功",h="assistantUpdate",d.id=t.id),d=B_Common._postData(d),B_Port._ajax(h,"post",!0,d,function(){B_Common._btnTextStatus("disable",$(".tg-main-btn"),{disable:"提交中..."})},function(){B_Common._btnTextStatus("normal",$(".tg-main-btn"),{normal:"确认提交"})},function(t,e){switch(h){case"assistantAddQuery":parent.F_Assistant_Info._getList(1);break;default:parent.F_Assistant_Info._pageRefresh()}parent.B_Pop._init("msg",{content:f}),B_Pop._init("closeFrame")},function(t,e,n){return B_Pop._init("msg",{content:e}),!1})})}});