var F_GameAnalysis_Entrance={_init:function(a){if(B_Login._checkUpdate(),M_HeadFoot._headShow(2),M_Dom._menuList("游戏详情","7-8"),B_User._isDemoUser())B_Login._openLogin("background");else{M_Init._clean();var e=B_Common._getUrl("query");e.g?(M_Init._gameDetailId=e.g,B_Game._setLast(M_Init._gameDetailId,"outsideGameDetail")):a?(M_Init._gameDetailId=a,B_Game._setLast(M_Init._gameDetailId,"outsideGameDetail")):M_Init._gameDetailId||(M_Init._gameDetailId=M_Init._getGameId("outsideGameDetail")),M_Game._checkGameVisitList("gameAnalysis")}}},F_GameAnalysis_Info={_chartClick:function(a,e){var t=[];switch(t.push("g="+M_Init._gameDetailId),a){case"bs_analyse_light":t.push("b="+B_Common._encodeUrl(M_Init._dateCache.begin)),t.push("e="+B_Common._encodeUrl(M_Init._dateCache.end)),t.push("a="+B_Common._encodeUrl(e.keyword)),t.push("z=channel");break;case"gameChannelCountLight":if(t.push("b="+B_Common._encodeUrl(M_Init._dateCache.begin2)),t.push("e="+B_Common._encodeUrl(M_Init._dateCache.end2)),M_Init._dataCache.channelCount)for(var n=M_Init._dataCache.channelCount,_=0;_<n.length;_++)if(n[_].source_name==M_Init._dataCache.currentChannel&&n[_].rating_name==e.date){t.push("forum="+B_Common._encodeUrl(n[_].source_name)),t.push("show="+B_Common._encodeUrl(n[_].rating_name)),t.push("l="+n[_].source_type),t.push("n="+n[_].es_field_name),t.push("v="+n[_].es_field_val);break}t.push("z=channel");break;case"bs_channel_detail":t.push("b="+B_Common._encodeUrl(B_Date._getDiffDate(null,-30))),t.push("e="+B_Common._encodeUrl(B_Date._getDiffDate(null,-1))),t.push("l="+B_Common._encodeUrl(e.id)),t.push("forum="+B_Common._encodeUrl(e.name)),t.push("z=channel")}t&&(t=t.join("&")),M_Outside._openDetail(t)},_domInit:function(){var a="";"S"==M_Game._gameInfo[3]&&(a+=M_Outside._domCreate("analysisChartTableDateTab",2,"1_0","渠道评分统计"),a+='<div class="blockpart tg-table-layout col-lg-12 col-md-12 col-sm-12 col-xs-12">',a+="<h3>AppStore排行榜</h3>",a+='<div class="tg-selected-drop tg-date-fl">',a+="<span>日期</span>",a+='<p class="tg-drop-text-part"><i class="tg-graph tg-triangle-gray-bottom"></i><span class="hot-area" id="dc3"></span><input id="db3" type="hidden" value=""><input id="de3" type="hidden" value=""></p></div>',a+='<div class="boxshadow tg-table-content gs-height-b">',a+='<div id="bs_rank_select"></div>',a+='<div id="bs_ranklist" style="width: 100%; height: 80%"></div>',a+="</div></div>",a+='<div class="blockpart col-lg-12 col-md-12 col-sm-12 col-xs-12 channel-infor">',a+="<h3>渠道信息</h3>",a+='<div id="bs_channel">',a+="</div></div>",a+='                <div class="blockpart col-lg-12 col-md-12 col-sm-12 col-xs-12" id="bs_channel_emotion">                    <h3>渠道评论情感分析</h3>                    <div class="tg-selected-drop tg-date-fl">                        <span>日期</span>                        <p class="tg-drop-text-part"><i class="tg-graph tg-triangle-gray-bottom"></i><span class="hot-area" id="dc1"></span><input id="db1" type="hidden" value=""><input id="de1" type="hidden" value=""></p>                    </div>                    <div class="boxshadow channel-emotion-2"></div>                </div>'),a+='<div class="more" id="bs_open_more">',a+='<iframe src="" frameborder="0" id="IframePart" class="iframe-more-date" height="100%" width="100%" scrolling="no"></iframe>',a+="</div>",$("#ct_main_area").addClass("channel-comment-part").html(a),M_Inside._downloadCsv(),"S"==M_Game._gameInfo[3]&&(B_Date._chooseSection({autoCommit:!0,todayValid:!1},2,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(a,e){a==M_Init._dateCache.begin2&&M_Init._dateCache.end2==e||(M_Init._dateCache.begin2=a,M_Init._dateCache.end2=e,F_GameAnalysis_Info._getCount())}),B_Date._chooseSection({autoCommit:!0,todayValid:!1},3,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(a,e){a==M_Init._dateCache.begin3&&M_Init._dateCache.end3==e||(M_Init._dateCache.begin3=a,M_Init._dateCache.end3=e,""==$("#bs_rank_select").html()?F_GameAnalysis_Info._getRankProperty():F_GameAnalysis_Info._getRankList())}),B_Date._chooseSection({autoCommit:!0,todayValid:!1},1,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(a,e){a==M_Init._dateCache.begin&&M_Init._dateCache.end==e||(M_Init._dateCache.begin=a,M_Init._dateCache.end=e,F_GameAnalysis_Info._getChannelEmotion())}),setTimeout(function(){F_GameAnalysis_Info._getChannel()},300))},_getChannelEmotion:function(){var a=$(".channel-emotion-2"),e={};e.start_date=M_Init._dateCache.begin,e.end_date=M_Init._dateCache.end,e.project_id=M_Init._gameDetailId,e=B_Common._postData(e),B_Port._ajax("channelAnalyse","get",!0,e,function(){a.html(B_Pre._loading())},function(){a.html("")},function(e,t){if(e){var n={neg:[],pos:[]};if(e.senti_word_distri&&e.senti_word_distri.length>0)for(var _=0;_<e.senti_word_distri.length;_++)n[e.senti_word_distri[_].senti_type]&&n[e.senti_word_distri[_].senti_type].push(e.senti_word_distri[_].keyword);if(a.html(F_GameAnalysis_Info._htmlChannelEmotionShow(n)),$(".channel-emotion-2 .positive-wrap li").each(function(){$(this).click(function(){F_GameAnalysis_Info._chartClick("bs_analyse_light",{keyword:$(this).html()+"/1"})})}),$(".channel-emotion-2 .negative-wrap li").each(function(){$(this).click(function(){F_GameAnalysis_Info._chartClick("bs_analyse_light",{keyword:$(this).html()+"/-1"})})}),e.senti_date_distri&&e.senti_date_distri.length>0){for(var i={color:["#71bc33","#f33f57"],x_axis:[],y_axis:[{name:"正面评论",data:[]},{name:"负面评论",data:[]}],xFormatDate:!0,legendSelectMode:!0},_=0;_<e.senti_date_distri.length;_++)i.x_axis.push(e.senti_date_distri[_].data_date),i.y_axis[0].data.push(e.senti_date_distri[_].pos_num),i.y_axis[1].data.push(-e.senti_date_distri[_].neg_num);M_Outside_Chart._chartData("barSum","bs_analyse_chart",i)}else $("#bs_analyse_chart").html(B_Pre._empty("暂无数据"))}else a.html(B_Pre._empty("暂无数据"))},function(e,t,n){a.html(B_Pre._empty(t))})},_htmlChannelEmotionShow:function(a){var e="";if(e+='<div class="left"><div class="graph-part cursor-default"><div id="bs_analyse_chart" style="width: 100%; height: 100%"></div></div></div>',e+='<div class="right">',e+="<ul>",e+='<li><i class="positive-bg"></i><span>正面评论</span></li>',e+='<ul class="positive-wrap">',a.pos&&a.pos.length>0)for(var t=0;t<a.pos.length;t++)e+="<li>"+a.pos[t]+"</li>";if(e+="</ul>",e+="</ul>",e+="<ul>",e+='<li><i class="negative-bg"></i><span>负面评论</span></li>',e+='<ul class="negative-wrap">',a.neg&&a.neg.length>0)for(var t=0;t<a.neg.length;t++)e+="<li>"+a.neg[t]+"</li>";return e+="</ul>",e+="</ul>",e+="</div>"},_getChannel:function(){var a=$("#bs_channel"),e={};e.project_id=M_Init._gameDetailId,e=B_Common._postData(e),B_Port._ajax("reputationIntroduce","get",!0,e,function(){a.html(B_Pre._loading())},function(){a.html("")},function(e,t){e.game_info&&(e.channel_info&&e.channel_info.length>0?(a.html(F_GameAnalysis_Info._htmlChannel(e.channel_info)),$(".bs_channel_detail").each(function(){$(this).click(function(){F_GameAnalysis_Info._chartClick("bs_channel_detail",{name:$(this).attr("data-n"),id:$(this).attr("data-i")})})})):a.html(B_Pre._empty("暂无数据")))},function(e,t,n){a.html(B_Pre._empty(t))})},_htmlChannel:function(a){for(var e="",t={},n=0;n<a.length;n++)t=B_Game._source(a[n].source_type),t=t?t.source_desc:"",e+='<div class="boxshadow"><img src="'+B_Game._imgSourceUrl(a[n].source_type,"small")+'">',e+='<ul class="channel-card-list">',e+="<li><span>评分</span>",e+="<span>"+a[n].rating_value+"</span>",e+="</li>",e+="<li><span>评价量</span>",e+='<span><a data-i="'+a[n].source_type+'" data-n="'+t+'" class="bs_channel_detail">'+a[n].rating_count+"</a></span>",e+="</li>",e+="<li><span>版本号</span>",e+="<span>"+a[n].version+"</span>",e+="</li>",e+="<li><span>下载量</span>",e+="<span>"+a[n].download_num+"</span>",e+="</li>",e+="<li><span>更新时间</span>",e+="<span>"+a[n].update_date+"</span>",e+="</li>",e+="</ul></div>";return e},_getTotal:function(){var a="0_0",e=$("#bs_chart_"+a),t=$("#bs_table_list_"+a),n={};n.start_date=M_Init._dateCache.begin,n.end_date=M_Init._dateCache.end,n.project_id=M_Init._gameDetailId,n=B_Common._postData(n),B_Port._ajax("forumAnalyse","get",!0,n,function(){e.html(B_Pre._loading()),t.html(B_Pre._loading()),$("#bs_page_"+a).html("")},function(){e.html(""),t.html("")},function(t,n){if(t&&t.y_axis){var _={head:["日期"],body:[]},i={x_axis:[],y_axis:[],xFormatDate:!0,legendSelectMode:!0,legendIsShow:!0};i.x_axis=t.x_axis,$.each(t.y_axis,function(a,e){_.head.push(a);for(var t=0;t<e.length;t++)_.body[t]||(_.body[t]=[i.x_axis[t]]),_.body[t].push(e[t]);i.y_axis.push({name:a,data:e})}),M_Outside_Chart._chartData("barSum","bs_chart_"+a,i,"gameForumTotalLight"),_.name="论坛帖子总量("+M_Init._dateCache.begin+"至"+M_Init._dateCache.end+")",M_Init._dataCache[a]=_,M_Init._dataCache.gameForumTotalData=t.y_axis_desc,M_Inside._tableHtml(1,a),M_Inside._chartTableIcon("together",0,"0")}else e.html(B_Pre._empty("暂无数据"))},function(a,t,n){e.html(B_Pre._empty(t))})},_getCount:function(){var a="1_0",e=$("#bs_chart_"+a),t=$("#bs_table_list_"+a),n={};n.start_date=M_Init._dateCache.begin2,n.end_date=M_Init._dateCache.end2,n.project_id=M_Init._gameDetailId,n=B_Common._postData(n),B_Port._ajax("channelCount","get",!0,n,function(){e.html(B_Pre._loading()),t.html(B_Pre._loading()),$("#bs_page_"+a).html("")},function(){e.html(""),t.html("")},function(t,n){if(t&&t.channel_rating_distri&&t.channel_rating_distri.length>0){M_Init._dataCache.channelCount=t.channel_rating_distri;for(var _=[],i={},s="",l=[],o=0,d=0;d<t.channel_rating_distri.length;d++){if(s=t.channel_rating_distri[d],$.inArray(s.source_name,_)>-1||_.push(s.source_name),!i[s.source_name]){l=s.rating_names.split(","),i[s.source_name]={x:l,y:[]};for(var c=0;c<l.length;c++)i[s.source_name].y.push(0)}o=$.inArray(s.rating_name,i[s.source_name].x),o>-1&&(i[s.source_name].y[o]=s.num)}if(M_Init._dataCache.countData=i,!M_Init._dataCache.currentChannel){for(var r="",d=0;d<_.length;d++)0==d?(M_Init._dataCache.currentChannel=_[d],r+='<li class="tg-tab-block-active">'):r+="<li>",r+=_[d]+"</li>";$("#bs_tab_"+a).html(r),$("#bs_tab_"+a+" li").each(function(){$(this).click(function(){$(this).hasClass("tg-tab-block-active")||($(this).addClass("tg-tab-block-active").siblings("li").removeClass("tg-tab-block-active"),M_Init._dataCache.currentChannel=$(this).html(),F_GameAnalysis_Info._chartCount(a))})})}F_GameAnalysis_Info._chartCount(a)}else e.html(B_Pre._empty("暂无数据"))},function(a,t,n){e.html(B_Pre._empty(t))})},_chartCount:function(a){var e={head:["评级","数量"],body:[]},t={x_axis:[],y_axis:[]};if(M_Init._dataCache.countData&&M_Init._dataCache.countData[M_Init._dataCache.currentChannel]){var n=M_Init._dataCache.countData[M_Init._dataCache.currentChannel];t.x_axis=n.x,t.y_axis.push({name:M_Init._dataCache.currentChannel,data:n.y});for(var _=0;_<n.y.length;_++)e.body[_]||(e.body[_]=[t.x_axis[_]]),e.body[_].push(n.y[_]);M_Outside_Chart._chartData("bar","bs_chart_"+a,t,"gameChannelCountLight"),M_Init._dataCache[a]=e,M_Inside._tableHtml(1,a),M_Inside._chartTableIcon("together",1,"0")}},_getRankProperty:function(){var a=$("#bs_ranklist"),e={};e.project_id=M_Init._gameDetailId,e=B_Common._postData(e),B_Port._ajax("appstoreClassify","get",!0,e,function(){a.html(B_Pre._loading())},function(){a.html("")},function(a,e){if(a.device_type_dim&&a.device_type_dim.length>0){if(""==$("#bs_rank_select").html()){var t=[];$.inArray(3,a.list_type_dim)>-1||$.inArray("3",a.list_type_dim)>-1?(M_Init._dataCache.listType=3,t.push({id:3,name:M_Game._appListType[3]})):M_Init._dataCache.listType=a.list_type_dim[0];for(var n=0;n<a.list_type_dim.length;n++)a.list_type_dim[n]+""!="3"&&t.push({id:a.list_type_dim[n],name:M_Game._appListType[a.list_type_dim[n]]});$("#bs_rank_select").prepend(F_GameAnalysis_Info._htmlRankSelect("bs_rank_select_list","榜单",t)),t=[],M_Init._dataCache.gameType=a.game_type_dim[0];for(var n=0;n<a.game_type_dim.length;n++)t.push({id:a.game_type_dim[n],name:M_Game._appGameType[a.game_type_dim[n]]});$("#bs_rank_select").prepend(F_GameAnalysis_Info._htmlRankSelect("bs_rank_select_type","类型",t)),t=[],M_Init._dataCache.deviceType=a.device_type_dim[0];for(var n=0;n<a.device_type_dim.length;n++)t.push({id:a.device_type_dim[n],name:M_Game._appPlatType[a.device_type_dim[n]]});$("#bs_rank_select").prepend(F_GameAnalysis_Info._htmlRankSelect("bs_rank_select_plat","设备",t)),M_Inside._dropShow(),M_Inside._dropLeave(),M_Inside._dropSelected(function(a){M_Init._dataCache.listType=a,F_GameAnalysis_Info._getRankList()},"bs_rank_select_list"),M_Inside._dropSelected(function(a){M_Init._dataCache.gameType=a,F_GameAnalysis_Info._getRankList()},"bs_rank_select_type"),M_Inside._dropSelected(function(a){M_Init._dataCache.deviceType=a,F_GameAnalysis_Info._getRankList()},"bs_rank_select_plat")}F_GameAnalysis_Info._getRankList()}else F_GameAnalysis_Info._getRankList()},function(e,t,n){a.html(B_Pre._empty(t))})},_htmlRankSelect:function(a,e,t){var n='<div class="tg-selected-drop tg-date-fl '+a+'">';n+="<span>"+e+"</span>",n+='<div class="tg-selected-drop"><p class="tg-drop-text-part">',n+='<i class="tg-graph tg-triangle-gray-bottom"></i><span id="tabSelect" data-i="'+t[0].id+'">'+t[0].name+"</span>",n+="</p>",n+='<ul style="display: none;">';for(var _=0;_<t.length;_++)n+='<li><a data-i="'+t[_].id+'">'+t[_].name+"</a></li>";return n+="</ul></div></div>"},_getRankList:function(){var a=$("#bs_ranklist");M_Init._dataCache.project=M_Init._dataCache.app=[];var e={};e.project_id=M_Init._gameDetailId,e.app_type=M_Init._dataCache.gameType?M_Init._dataCache.gameType:0,e.list_type=M_Init._dataCache.listType?M_Init._dataCache.listType:0,e.device_type=M_Init._dataCache.deviceType?M_Init._dataCache.deviceType:0,e.start_date=M_Init._dateCache.begin3,e.end_date=M_Init._dateCache.end3,e=B_Common._postData(e),B_Port._ajax("reputationIntroduceOpinion","get",!0,e,function(){a.html(B_Pre._loading())},function(){a.html("")},function(e,t){e?(M_Init._dataCache.project=e.project_rank&&e.project_rank.length>0?e.project_rank:[],M_Init._dataCache.app=e.app_store&&e.app_store.length>0?e.app_store:[],F_GameAnalysis_Info._chartRank()):a.html(B_Pre._empty("暂无数据"))},function(e,t,n){a.html(B_Pre._empty(t))})},_chartRank:function(){var a={x_axis:[],y_axis:[],xFormatDate:!0,yFormat:"",legendSelectMode:!1,inverse:!0,yMin:1,yMax:0},e="";a.y_axis.push({name:"AppStore排行榜",data:[]}),e=M_Init._dataCache.app;for(var t=[],n=0;n<e.length;n++)a.x_axis.push(e[n].data_date),a.yMax=a.yMax>parseInt(e[n].rank)?a.yMax:parseInt(e[n].rank),t.push(e[n].rank);a.yMax=a.yMax<5?5:0,a.y_axis[0].data=t,M_Outside_Chart._chartData("line","bs_ranklist",a)}};