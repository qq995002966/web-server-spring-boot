require(["frontmain"],function(){require(["jquery","echarts","china","numbers","layer","base","front","store.min","app/outside"],function(){store=require("store.min"),echarts=require("echarts"),F_Guide_Entrance._init()})});var F_Guide_Entrance={_init:function(){B_Login._check(),S_HeadFoot._getHead(),setInterval('F_Guide_Trend._getTrend("realtime")',6e4),F_Guide_Trend._getTrend("realtime"),F_Guide_GameMap._getMap(),F_Guide_GameMap._getRank("手游"),F_Guide_Complain._getComplain("手游"),F_Guide_Type._getType(),F_Guide_AppStore._getApp(),S_Game._goRelation()}},F_Guide_Common={_cache:{},_htmlTabChoose:function(t){var e="";return e+='<span class="tab-title">游戏类型</span>',e+='<ul class="tf-tab-change-btn '+t+'">',e+='<li class="selected">手游</li><li>页游</li><li>端游</li><li>单机</li>',e+="</ul>"},_clickChoose:function(t,e){$("."+t+" li").each(function(){$(this).click(function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings("li").removeClass("selected"),e&&e($(this).html()))})})}},F_Guide_AppStore={_more:function(t){var e=F_Guide_AppStore._getCondition("more");window.open("rank.html?"+e+"&c="+B_Common._encodeUrl(t))},_getCondition:function(t){var e="",a="";$(".bs_app_type li").each(function(){$(this).hasClass("selected")&&(a=$(this).attr("data-i"))}),$(".bs_app_device li").each(function(){$(this).hasClass("selected")&&(e=$(this).attr("data-i"))});var _={};switch(t){case"more":_.p=e,_.t=a,_.d=B_Date._getDiffDate(null,-1);break;default:_.device_type=e,_.list_type=a,_.data_date=B_Date._getDiffDate(null,-1)}return B_Common._postData(_)},_getApp:function(){var t=$("#bs_appStore");B_Port._ajax("industryAppStore","get",!0,F_Guide_AppStore._getCondition(),function(){t.html(B_Pre._loading())},function(){t.html("")},function(t,e){t.appstore_type_distri&&F_Guide_AppStore._chartApp(t.appstore_type_distri)},function(e,a,_){t.html(B_Pre._empty(a))}),F_Guide_Common._clickChoose("bs_app_type",function(t){F_Guide_AppStore._getApp()}),F_Guide_Common._clickChoose("bs_app_device",function(t){F_Guide_AppStore._getApp()})},_chartApp:function(t){for(var e={x_axis:[],y_axis:[{data:[],name:"数量"}]},a="",_=0;_<t.length;_++)M_Game._appGameType[t[_].app_type]&&(a=M_Game._appGameType[t[_].app_type],"小游戏"!=a&&(a=a.replace("游戏","")),e.x_axis.push(a),e.y_axis[0].data.push(t[_].app_num));S_Chart._chartData("bar","bs_appStore",e,"appStoreRank")}},F_Guide_Type={_getType:function(){var t=$("#bs_type");B_Port._ajax("industryTypeDistri","get",!0,null,function(){t.html(B_Pre._loading())},function(){t.html("")},function(e,a){if(e.type_num_distri){var _="";_+='<div class="tf-graph-part gamestyle-distribute" id="bs_type_chart"></div>',_+='<div id="bs_type_table"></div>',t.html(_),F_Guide_Type._htmlTypeList(e.type_num_distri)}},function(e,a,_){t.html(B_Pre._empty(a))})},_htmlTypeList:function(t){for(var e={x_axis:[],y_name:[],y_axis:[{data:[],name:"占比(%)"}],legendSelectMode:!0,inverse:!0,xSplitLine:!0},a=[],_="",i="",n=t["手游"],r=0,s=0,o=[["手游","#72C4FF"],["页游","#BFA4F1"],["端游","#FFA6A5"],["单机","#AEDD8C"]],d=0;d<o.length;d++)if(n=t[o[d][0]]){e.y_name.push(o[d][0]),a[d]=[];for(var c=0;c<n.length;c++){if(0==d)a[d][c]="-",r=c,e.x_axis.push(n[c].detail_type);else{if(0==c)for(var l=0;l<e.x_axis.length;l++)a[d][l]="-";r=$.inArray(n[c].detail_type,e.x_axis)}r>-1&&(s=parseInt(100*n[c].game_rate).toFixed(0),a[d][r]=s+"%",e.y_axis[0].data.push({value:[r,d,s],itemStyle:{normal:{color:o[d][1]}}}))}}i+="<thead><th></th>";for(var c=0;c<e.x_axis.length;c++)i+='<th><i class="game-type-color'+(c+1)+'"></i>'+e.x_axis[c]+"</th>";i+="</thead>",_+="<tbody>";for(var c=0;c<a.length;c++){_+="<tr>",_+="<td>"+o[c][0]+"</td>";for(var l=0;l<a[c].length;l++)_+="<td>"+a[c][l]+"</td>";_+="</tr>"}_+="</tbody>",$("#bs_type_table").html('<table class="game-style-dis">'+i+_+"</table>"),F_Guide_Common._cache.typePlat=e.y_name,F_Guide_Common._cache.typeClassify=e.x_axis,S_Chart._chartData("scatter","bs_type_chart",e)}},F_Guide_Complain={_getComplain:function(t){if(F_Guide_Common._cache.complain)F_Guide_Complain._htmlComplainList(F_Guide_Common._cache.complain[t]);else{var e=$("#bs_complain");B_Port._ajax("industryComplain","get",!0,null,function(){e.html(B_Pre._loading())},function(){e.html("")},function(a,_){if(a.negtive_distri_all){F_Guide_Common._cache.complain=a.negtive_distri_all;var i="";i+=F_Guide_Common._htmlTabChoose("bs_complain_choose"),i+='<div id="bs_complain_choose_list">',i+='<div class="tf-graph-part " id="bs_complain_chart"></div>',i+='<div id="bs_complain_table"></div>',i+="</div>",e.html(i),F_Guide_Complain._htmlComplainList(a.negtive_distri_all[t]),F_Guide_Common._clickChoose("bs_complain_choose",function(t){F_Guide_Complain._getComplain(t)})}},function(t,a,_){e.html(B_Pre._empty(a))})}},_htmlComplainList:function(t){for(var e=[],a=[],_=[],i="",n="",r="",s=0,o=0,d=0;d<t.length;d++)s=(100*t[d].complain_rate).toFixed(1),o=(100*t[d].negative_post_rate).toFixed(1),i+='<th><i class="game-type-color'+d+'"></i>'+t[d].detail_type+"</th>",n+="<td>"+s+"%</td>",r+="<td>"+o+"%</td>",e.push(t[d].detail_type),a.push(s),_.push(o);var c={color:["#F7D960","#F75869"],x_axis:e,y_axis:[{data:a,name:"抱怨用户"},{data:_,name:"负面反馈"}],legendSelectMode:!1,tooltip:{num:2,unit:"%"},yFormat:"%"};$("#bs_complain_table").html('<table class="game-style-dis"><thead><th></th>'+i+"</thead><tbody><tr><td>抱怨用户</td>"+n+"</tr><tr><td>负面反馈</td>"+r+"</tr></tbody></table>"),S_Chart._chartData("bar","bs_complain_chart",c)}},F_Guide_GameMap={_getMap:function(){var t=$("#bs_chart_map");B_Port._ajax("industryUserProvince","get",!0,null,function(){t.html(B_Pre._loading())},function(){t.html("")},function(t,e){if(t.province_distri&&t.province_distri.length>0){for(var a={x_axis:[],y_axis:[{data:[],name:"活跃玩家占比(%)"}],visualMax:0},_=0;_<t.province_distri.length;_++){var i=(100*t.province_distri[_].active_rate).toFixed(1);a.y_axis[0].data.push({name:t.province_distri[_].province,value:i}),parseFloat(i)>parseFloat(a.visualMax)&&(a.visualMax=i)}a.visualMax=Math.ceil(a.visualMax),S_Chart._chartData("map","bs_map_chart",a)}},function(e,a,_){t.html(B_Pre._empty(a))})},_getRank:function(t){if(F_Guide_Common._cache.activityRank)$("#bs_rank_choose_list").html(F_Guide_GameMap._htmlRankList(F_Guide_Common._cache.activityRank[t]));else{var e=$("#bs_rank_chart");B_Port._ajax("industryGameType","get",!0,null,function(){e.html(B_Pre._loading())},function(){e.html("")},function(a,_){if(a.game_type_distri){F_Guide_Common._cache.activityRank=a.game_type_distri;var i="";i+=F_Guide_Common._htmlTabChoose("bs_rank_choose"),i+='<div id="bs_rank_choose_list">'+F_Guide_GameMap._htmlRankList(a.game_type_distri[t])+"</div>",e.html(i),F_Guide_Common._clickChoose("bs_rank_choose",function(t){F_Guide_GameMap._getRank(t)})}},function(t,a,_){e.html(B_Pre._empty(a))})}},_htmlRankList:function(t){var e="";e+='<table class="game-style"><thead><th>游戏类别</th><th>游戏数占比</th><th>用户占比</th><th>较昨日</th><th>活跃帖子数</th><th>较昨日</th></thead><tbody>';for(var a=0;a<t.length;a++)e+="<tr>",e+="<td>",e+='<i class="game-type-color'+(a+1)+'"></i>',e+=t[a].detail_type+"</td>",e+="<td>"+(t[a].game_rate?(100*t[a].game_rate).toFixed(1):"0")+"%</td>",e+="<td>"+(t[a].user_rate?(100*t[a].user_rate).toFixed(1):"0")+"%</td>",t[a].user_rate_growth?t[a].user_rate_growth>0?e+='<td class="color-red">+'+(100*t[a].user_rate_growth).toFixed(1)+"%</td>":t[a].user_rate_growth<0?e+='<td class="color-green">-'+(100*Math.abs(t[a].user_rate_growth)).toFixed(1)+"%</td>":e+="<td>0.0%</td>":e+="<td>-</td>",e+="<td>"+(t[a].post_num?t[a].post_num:"0")+"</td>",t[a].post_num_growth?t[a].post_num_growth>0?e+='<td class="color-red">+'+(100*t[a].post_num_growth).toFixed(1)+"%</td>":t[a].post_num_growth<0?e+='<td class="color-green">-'+(100*Math.abs(t[a].post_num_growth)).toFixed(1)+"%</td>":e+="<td>0.0%</td>":e+="<td>-</td>",e+="</tr>";return e+="</tbody></table>"}},F_Guide_Trend={_clickTab:function(){$(".bs_trend_type li").each(function(t){$(this).click(function(){if(!$(this).hasClass("selected"))switch($(this).addClass("selected").siblings("li").removeClass("selected"),t+""){case"0":$("#bs_trend_chart").show(),$("#bs_trendDay_chart").hide();break;case"1":$("#bs_trend_chart").hide(),$("#bs_trendDay_chart").show(),F_Guide_Trend._getTrend("forum")}})}),$(".bs_trend_tab li").each(function(t){$(this).click(function(){if(!$(this).hasClass("selected"))switch($(this).addClass("selected").siblings("li").removeClass("selected"),t+""){case"0":$(".bs_trend_type").show();var e="";switch($(".bs_trend_type li").each(function(t){$(this).hasClass("selected")&&(e=t)}),e+""){case"0":$("#bs_trend_chart").show(),$("#bs_trendDay_chart").hide();break;case"1":$("#bs_trendDay_chart").show(),$("#bs_trend_chart").hide(),F_Guide_Trend._getTrend("forum")}break;case"1":case"2":switch($("#bs_trendDay_chart").show(),$(".bs_trend_type").hide(),$("#bs_trend_chart").hide(),t+""){case"1":F_Guide_Trend._getTrend("channel");break;case"2":F_Guide_Trend._getTrend("article")}}})})},_getTrend:function(t){if("realtime"!=t&&F_Guide_Common._cache.trendDay)F_Guide_Trend._formatPublish(t);else{var e="",a="";switch(t){case"realtime":e=$("#bs_trend_chart"),a="realtime";break;case"forum":case"channel":case"article":e=$("#bs_trendDay_chart"),a="day"}var _={};_.scope=a,_=B_Common._postData(_),B_Port._ajax("industryGeneral","get",!0,_,function(){switch(t){case"realtime":break;default:e.html(B_Pre._loading())}},function(){e.html("")},function(e,a){if(e)switch(t){case"realtime":F_Guide_Trend._formatActive(e);break;case"forum":case"channel":case"article":F_Guide_Common._cache.trendDay=e.industry_distri_day,F_Guide_Trend._formatPublish(t)}F_Guide_Trend._clickTab()},function(){e.html(B_Pre._empty(msg))})}},_formatActive:function(t){F_Guide_Common._cache.rand=t.title_distri_realtime&&t.title_distri_realtime.length>0?t.title_distri_realtime[t.title_distri_realtime.length-1].title_num:0;var e=parseInt(t.title_num_today_total)-parseInt(F_Guide_Common._cache.rand);if(F_Guide_Common._cache.number=e<0?F_Guide_Common._cache.rand:e,F_Guide_Trend._htmlNumber(t),F_Guide_Trend._effectNumber(),t.title_distri_realtime&&t.title_distri_realtime.length>0){F_Guide_Common._cache.allDate=[],F_Guide_Common._cache.allData=[];for(var a={x_axis:[],y_axis:[{data:[],name:"发帖数"}],yMax:0,yMin:1e9},_=t.title_distri_realtime,i=0,n=1e9,r=0;r<_.length;r++){var s=_[r].data_time.toString().replace(":00","");r<30&&(a.x_axis.push(s),a.y_axis[0].data.push(_[r].title_num)),i=i>parseInt(_[r].title_num)?i:_[r].title_num,n=n<parseInt(_[r].title_num)?n:_[r].title_num,F_Guide_Common._cache.allDate.push(s),F_Guide_Common._cache.allData.push(_[r].title_num)}a.yMax=(1.2*i).toFixed(0),a.yMin=(n/1.5).toFixed(0),S_Chart._chartData("lineActive","bs_trend_chart",a)}},_formatPublish:function(t){if(F_Guide_Common._cache.trendDay){var e=F_Guide_Common._cache.trendDay,a={x_axis:[],y_axis:[{data:[],name:"发布数"}],xFormatDate:!0},_="";switch(t){case"forum":_="forum_post_num";break;case"channel":_="chan_post_num";break;case"article":_="article_post_num"}for(var i=0,n=0,r=0;r<e.length;r++)n=parseInt(e[r][_]),i<n&&(i=n),a.x_axis.push(e[r].data_date),a.y_axis[0].data.push(n);"forum"==t&&(a.yMax=2*i),S_Chart._chartData("line","bs_trendDay_chart",a)}},_formatPercent:function(t,e){t=parseInt(t),e=parseInt(e);var a=(100*(t/e-1)).toFixed(2);return t>=e?"+"+a+"%":a+"%"},_htmlNumber:function(t){$(".tf-tab-change-block li").each(function(e){var a=0,_=0,i=0,n=0;switch(e){case 0:a=F_Guide_Trend._formatPercent(t.title_num_today_total,t.title_num_yesterday_basis),i=t.title_num_yesterday_basis,n=t.title_num_yesterday_total;break;case 1:a=F_Guide_Trend._formatPercent(t.channel_num_today_total,t.channel_num_yesterday_basis),_=t.channel_num_today_total,i=t.channel_num_yesterday_basis,n=t.channel_num_yesterday_total;break;case 2:a=F_Guide_Trend._formatPercent(t.article_num_today_total,t.article_num_yesterday_basis),_=t.article_num_today_total,i=t.article_num_yesterday_basis,n=t.article_num_yesterday_total}0==e||$(this).find("h4").html(_),$(this).find("b").html(a),parseFloat(a)>0?$(this).find("b").addClass("color-green"):parseFloat(a)<0&&$(this).find("b").addClass("color-red"),$(this).find(".post-num-compare").html("昨日同比发布数:<b>"+i+"</b>"),$(this).find(".post-num-all").html("昨日全天发布数:<b>"+n+"</b>")})},_effectNumber:function(){F_Guide_Common._cache.number=parseInt(F_Guide_Common._cache.number),F_Guide_Common._cache.rand=parseInt(F_Guide_Common._cache.rand);var t=$(".bs_change_number").numberAnimate({num:F_Guide_Common._cache.number,speed:2e3});if(F_Guide_Common._cache.rand>0){var e=Math.ceil(F_Guide_Common._cache.rand/2),a=Math.floor(e/60),_=F_Guide_Common._cache.rand-e,i=_;setInterval(function(){var e=Math.ceil(Math.random()*i);i-=e,F_Guide_Common._cache.number+=a+e,t.resetData(F_Guide_Common._cache.number)},5e3)}}};