var F_ChatResult_Entrance={_init:function(t){if(B_Login._checkUpdate(),M_HeadFoot._headShow(2),M_Dom._menuList("舆情分析","3-1-4"),M_Game._htmlGameVisitHide("outsideChat"),B_User._isDemoUser())B_Login._openLogin("background");else{M_Init._clean();var _=B_Common._getUrl("query");if(_.id?F_ChatResult_Info._id=_.id:t&&(F_ChatResult_Info._id=t),!F_ChatResult_Info._id||isNaN(F_ChatResult_Info._id))return B_Pop._init("msg",{content:"选择的数据不存在"}),!1;F_ChatResult_Info._getInfo(),F_ChatResult_Info._getWords(),F_ChatResult_Info._getEmotion(),F_ChatResult_Words._getInfo(),F_ChatResult_Topic._getInfo(),F_ChatResult_User._getInfo()}}},F_ChatResult_Info={_id:"",_getInfo:function(){var t={};t.info_id_list=F_ChatResult_Info._id,t.index=0,t.limit=1,t=B_Common._postData(t),B_Port._ajax("talkInfo","get",!0,t,function(){$("#bs_info_title").html(B_Pre._loading())},function(){$("#bs_info_title").html("")},function(t,_){$("#bs_info_title").html(F_ChatResult_Info._htmlInfo(t))},function(t,_,e){$("#bs_info_title").html(B_Pre._empty(_))})},_getWords:function(){var t={};t.info_id=F_ChatResult_Info._id,t=B_Common._postData(t),B_Port._ajax("talkDetailTopic","get",!0,t,function(){$("#bs_emotion_word").html(B_Pre._loading())},function(){$("#bs_emotion_word").html("")},function(t,_){if(t.get&&t.get.length>0){var e=F_ChatResult_Info._formatWord(t.get);M_Common._wordCloudShow($("#bs_emotion_word"),e.word,null,e.color),$("#bs_emotion_word a").each(function(){$(this).click(function(){var t=$(this).html();F_ChatResult_Common._openDetail("detail",{word:t}),wordCloudObj.resume()})})}},function(t,_,e){$("#bs_emotion_word").html(B_Pre._empty(_))})},_getEmotion:function(){var t={};t.info_id=F_ChatResult_Info._id,t=B_Common._postData(t),B_Port._ajax("talkEmotion","get",!0,t,function(){$("#bs_emotion_percent").html(B_Pre._loading())},function(){$("#bs_emotion_percent").html("")},function(t,_){if(t.get&&t.get.length>0){for(var e={legend:["正面","负面"],data:[{value:0,name:"正面"},{value:0,name:"负面"}]},o=0;o<t.get.length;o++)t.get[o].attitude_score>0&&(e.data[0].value+=t.get[o].post_num),t.get[o].attitude_score<0&&(e.data[1].value+=t.get[o].post_num);F_ChatResult_Info._chartEmotion(e),F_ChatResult_Info._htmlEmotion(e.data[0].value,e.data[1].value)}else $("#bs_emotion_percent").html("暂无数据")},function(t,_,e){$("#bs_emotion_percent").html(B_Pre._empty(_))})},_htmlEmotion:function(t,_){var e="",o=t+_,a=["0%","0%"];o>0&&(a[0]=(t/o*100).toFixed(1)+"%",a[1]=(_/o*100).toFixed(1)+"%"),e+='<div class="positive">            <i class="graph-icon"></i>            <span>正面反馈</span>            <ul class="fr">            <li>            <b>'+t+"</b>            <span>正面反馈量</span>            </li>            <li>            <b>"+a[0]+'</b>            <span>占全部反馈的</span>            </li>            </ul>            </div>            <div>            <i class="graph-icon"></i>            <span>负面反馈</span>            <ul class="fr">            <li>            <b>'+_+"</b>            <span>负面反馈量</span>            </li>            <li>            <b>"+a[1]+"</b>            <span>占全部反馈的</span>            </li>            </ul>            </div>",$("#lt_emotion_percent").html(e)},_chartEmotion:function(t){var _={};_.tooltip={trigger:"item",formatter:"{b}:{c}"},_.legend={itemWidth:12,itemHeight:12,left:"center",top:"bottom",data:t.legend,textStyle:{fontSize:12}},_.color=["#2ed383 ","#f7606f"],_.grid={containLabel:!0},_.series=[{type:"pie",hoverAnimation:!1,center:["50%","40%"],radius:["30%","80%"],label:{normal:{show:!1}},labelLine:{normal:{show:!1}},data:t.data}],B_Chart._getEChart("pie","bs_emotion_percent",_)},_formatWord:function(t){for(var _={word:[],color:[]},e=0;e<t.length;e++)switch(_.word.push(t[e].keyword),t[e].senti_type){case"pos":_.color.push("lt_fmPlWPos");break;case"neg":_.color.push("lt_fmPlWNeg")}return _},_htmlInfo:function(t){var _="";return t&&t.get&&t.get[0]&&(t=t.get[0],_+='<span>对文件 "'+B_Common._decodeUrl(t.file_name)+'" 中 '+(t.start_date?t.start_date.replace(".0",""):"")+" 至 "+(t.end_date?t.end_date.replace(".0",""):"")+" 期间的聊天分析结果</span>"),_+="<button onclick=\"B_Jump._go('base','"+B_Jump._getUrl("outsideChat")+'\')" class="tg-main-btn">返回聊天分析任务</button>'}},F_ChatResult_Words={_getInfo:function(){var t={};t.info_id=F_ChatResult_Info._id,t=B_Common._postData(t),B_Port._ajax("talkKeywords","get",!0,t,function(){$("#bs_chatresult_keywords").html(B_Pre._loading())},function(){$("#bs_chatresult_keywords").html("")},function(t,_){t.get&&t.get.length>0?F_ChatResult_Words._chartBar(t.get):$("#bs_chatresult_keywords").html("暂无数据")},function(t,_,e){$("#bs_chatresult_keywords").html(B_Pre._empty(_))})},_chartBar:function(t){for(var _={},e={xAxis:[],data:[]},o=0;o<t.length;o++)e.xAxis.push(t[o].keyword),e.data.push(t[o].num);_.tooltip={trigger:"axis"},_.legend={},_.grid={left:"2%",right:"2%",bottom:"12%",top:"5%",containLabel:!0},_.dataZoom=[{show:!0,start:0,end:6,zoomLock:!0}],_.xAxis=[{splitLine:{show:!1},type:"category",data:e.xAxis,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{textStyle:{color:"#333333",fontSize:"11px"},interval:"0"}}],_.yAxis=[{splitLine:{lineStyle:{color:"#EEEEEE"}},type:"value",nameLocation:"middle",nameTextStyle:{color:"#C2C2C2",fontSize:"11px"},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{textStyle:{color:"#333333",fontSize:"11px"}}}],_.series=[{barMaxWidth:30,type:"bar",name:"热度",label:{normal:{show:!0,position:"top"}},data:e.data}],_.color=["#43abe1"],B_Chart._getEChart("keywords","bs_chatresult_keywords",_)}},F_ChatResult_Topic={_cache:{},_formatTopic:function(t){if(F_ChatResult_Topic._cache.TopicData){for(var _=F_ChatResult_Topic._cache.TopicData,e="",o=0;o<_.length;o++)if(_[o].topic_keywords==t){e=_[o].topic_id;break}""!=e&&F_ChatResult_Common._openDetail("topic",{word:e,title:t})}},_getInfo:function(){var t={};t.info_id=F_ChatResult_Info._id,t=B_Common._postData(t),B_Port._ajax("talkTopic","get",!0,t,function(){$("#bs_chatresult_topic").html(B_Pre._loading())},function(){$("#bs_chatresult_topic").html("")},function(t,_){t.get&&t.get.length>0&&(F_ChatResult_Topic._cache.TopicData=t.get,F_ChatResult_Topic._chartTopic(t.get),F_ChatResult_Topic._htmlWordList(t.get))},function(t,_,e){$("#bs_chatresult_topic").html(B_Pre._empty(_))})},_chartTopic:function(t){for(var _={},e={data:[]},o=0;o<t.length&&!(o>=10);o++)e.data.push({name:t[o].topic_keywords,path:t[o].topic_id,value:t[o].post_num});_.tooltip={trigger:"item"},_.legend={},_.series=[{roam:!1,breadcrumb:{show:!1},nodeClick:!1,type:"treemap",visibleMin:300,label:{show:!0,formatter:"{b}"},data:e.data}],_.color=["#3daae3","#2ed383","#8b5c9b","#ec644c","#466cd0","#3fa553","#524a89","#eb9831"],B_Chart._getEChart("line","bs_chatresult_topic",_)},_htmlWordList:function(t){var _="";_+='<table class="tg-table table table-bordered"><thead class="boxshadow">                    <tr>                    <th>编号</th>                    <th>话题摘要</th>                    <th>聊天片段数量</th>                    <th>聊天记录数</th>                    <th>参与人数</th>                </tr></thead><tbody>';for(var e=1,o=0;o<t.length&&!(e>10);o++)t[o].topic_keywords&&""!=t[o].topic_keywords&&(_+='<tr data-w="'+t[o].topic_keywords+'">                            <td>'+e+"</td>                            <td>"+t[o].topic_keywords+"</td>                            <td>"+t[o].session_num+"</td>                            <td>"+t[o].post_num+"</td>                            <td>"+t[o].user_num+"</td>                        </tr>",e++);_+="</tbody></table>",$("#bs_topic_list").html(_),$("#bs_topic_list table tr").each(function(){$(this).click(function(){var t=$(this).attr("data-w");""!=t&&F_ChatResult_Topic._formatTopic(t)})})}},F_ChatResult_User={_cache:{},_getSession:function(t,_){var e={};e.index=0,e.limit=5,e.topic_id=t,e.info_id=F_ChatResult_Info._id,e=B_Common._postData(e),B_Port._ajax("talkTopic","get",!0,e,function(){$("#bs_chatresult_topic_list").html(B_Pre._loading())},function(){$("#bs_chatresult_topic_list").html("")},function(e,o){if(e.get&&e.get.length>0){for(var a="<ul>",i="",s=0;s<e.get.length;s++)0==s&&(i=e.get[s].session_id),a+=F_ChatResult_User._htmlSession(e.get[s],s,_);a+="</ul>",$("#bs_chatresult_topic_list").html(a),""!=i&&F_ChatResult_User._getSessionDetail(t,i,_),$("#bs_chatresult_topic li").each(function(t){$(this).click(function(){if(!$(this).hasClass("tk_rts_border")){$(this).addClass("tk_rts_border").siblings().removeClass("tk_rts_border"),$(this).siblings("li").find(".tk_rts_lt_cal").removeClass("tk_rts_lt_cal_on").addClass("tk_rts_lt_cal_off"),$(this).find(".tk_rts_lt_cal").addClass("tk_rts_lt_cal_on").removeClass("tk_rts_lt_cal_off");var t=$(this).attr("data-s"),_=$(this).attr("data-w"),e=$(this).attr("data-t");F_ChatResult_User._getSessionDetail(_,t,e)}})})}else $("#bs_chatresult_topic_list").html("暂无数据")},function(t,_,e){$("#bs_chatresult_topic_list").html(B_Pre._empty(_))})},_getSessionDetail:function(t,_,e){var o={};o.topic_id=t,o.session_id=_,o.source_type=e,o=B_Common._postData(o),F_ChatResult_User._getDetail($("#bs_chatresult_topic_detail"),1,o,null,"topic")},_htmlSession:function(t,_,e){var o="";switch(_+""){case"0":o+='<li class="tk_rts_border" data-w="'+t.topic_id+'" data-s="'+t.session_id+'" data-t="'+e+'"><div class="tk_rts_lt_cal tk_top_img tk_rts_lt_cal_on">';break;default:o+='<li data-w="'+t.topic_id+'" data-s="'+t.session_id+'" data-t="'+e+'"><div class="tk_rts_lt_cal tk_top_img tk_rts_lt_cal_off">'}return o+="会话"+(_+1)+'</div><div class="tk_rts_lt_info"><span title="'+t.session_summary+'">'+t.session_summary+"</span>",o+="共"+t.user_num+"人参与，产生"+t.post_num+"条聊天记录</div></li>"},_getInfo:function(){var t={};t.info_id=F_ChatResult_Info._id,t=B_Common._postData(t),B_Port._ajax("talkUser","get",!0,t,function(){$("#bs_user").html(B_Pre._loading())},function(){$("#bs_user").html("")},function(t,_){t.get&&t.get.length>0?(F_ChatResult_User._cache.userData=t.get,$("#bs_user").html(F_ChatResult_User._htmlUserList(t.get))):$("#bs_user").html("暂无数据")},function(t,_,e){$("#bs_user").html(B_Pre._empty(_))})},_getDetail:function(t,_,e,o,a){var i=(_-1)*B_Page._size,s={};s.info_id=F_ChatResult_Info._id,s.index=i,s.limit=B_Page._size,s=B_Common._postData(s),B_Port._ajax("talkQueryPost","get",!0,e+"&"+s,function(){1==_?t.html(B_Pre._loading()):t.find(".tk_rt_topic_man_more span").unbind("click").html("加载中...")},function(){1==_&&t.html("")},function(i,s){if(i.data.list&&i.data.list.length>0){var n=_*B_Page._size>=i.data.total;switch(t.find(".tk_rt_topic_man_more").remove(),a){case"topic":t.append(F_ChatResult_User._htmlTopic(i.data.list,n));break;default:t.append(F_ChatResult_User._htmlDetail(i.data.list,n,o))}n?t.find(".tk_rt_topic_man_more span").unbind("click"):t.find(".tk_rt_topic_man_more span").bind("click",function(){F_ChatResult_User._getDetail(t,_+1,e,o,a)}).addClass("c_cursor")}else 1==_&&t.html("暂无数据")},function(e,o,a){1==_&&t.html(B_Pre._empty(o))})},_htmlTopic:function(t,_){for(var e="",o=0;o<t.length;o++)e+=o%2==0?"<dl>                        <dt>【"+t[o].source.qq_id+"】 "+t[o].source.author+"   "+t[o].source.publish_time+'</dt>                        <dd>                            <i class="tk_top_img b_floatLeft mg_right"></i>                            <span class="b_floatLeft"><div class="ar_left tk_top_img"></div>'+t[o].source.content+'</span>                            <div class="clearfix"></div>                        </dd>                     </dl>':'<dl>                        <dt style="text-align: right">【'+t[o].source.qq_id+"】 "+t[o].source.author+"   "+t[o].source.publish_time+'</dt>                        <dd>                            <i class="tk_top_img b_floatRight mg_left"></i>                            <span class="b_floatRight"><div class="ar_right tk_top_img"></div>'+t[o].source.content+'</span>                            <div class="clearfix"></div>                        </dd>                    </dl>';return e+=_?'<div class="tk_rt_topic_man_more"><span>已显示全部</span></div>':'<div class="tk_rt_topic_man_more"><span>点击查看更多</span></div>'},_htmlDetail:function(t,_,e){for(var o="",a=0;a<t.length;a++)o+="<dl>                        <dt>"+t[a].source.publish_time+"</dt>                        <dd>"+B_Common._focusKeywords(e,t[a].source.content)+"</dd>                    </dl>";return o+=_?'<div class="tk_rt_topic_man_more"><span>已显示全部</span></div>':'<div class="tk_rt_topic_man_more"><span>点击查看更多</span></div>'},_htmlUserList:function(t){for(var _="",e="",o=0;o<t.length&&!(o>=10);o++)switch(o){case 0:e={},e.qq_id=t[o].qq_id,e.source_type=10,e=B_Common._postData(e),_+=F_ChatResult_User._htmlUserFirst(t[o]);break;case 1:_+='<div class="tk_rt_topic_man_list"><ul>',_+=F_ChatResult_User._htmlUserLeft(o,t[o]);break;default:_+=F_ChatResult_User._htmlUserLeft(o,t[o])}""!=_&&t.length>1&&(_+='</ul></div><div class="clearfix"></div>'),$("#bs_user").html(_),""!=e&&(F_ChatResult_User._getDetail($(".tk_rt_topic_man_detail"),1,e),$(".tk_rt_topic_man_list .tk_rt_detail").each(function(t){$(this).click(function(){if(F_ChatResult_User._cache.userData[t+1]){var _=F_ChatResult_User._cache.userData[t+1];F_ChatResult_Common._openDetail("user",{qq:_.qq_id,author:_.author,relation:_.top_keywords})}})}))},_htmlUserFirst:function(t){var _="";return t.top_keywords&&(t.top_keywords=t.top_keywords.split(" "),t.top_keywords=t.top_keywords.join("<br>")),_+='            <div class="tk_rt_topic_man_top">                <div class="tk_top_img tk_rt_topic_man_top_info b_relative b_floatLeft">                    <div class="tk_rt_number">TOP1</div>                    <div class="tk_rt_user">                        昵称：'+t.author+"<br>                        QQ号："+t.qq_id+"<br>                        聊天条数：共"+t.post_num+'条<br>                    </div>                </div>                <div class="tk_rt_topic_man_top_list b_floatLeft">                    <div class="tk_rt_topic_man_detail tk_rt_topic_man_detail_width b_floatLeft"></div>                    <div class="tk_rt_topic_man_keyword b_floatRight b_relative">                        <div class="tk_top_img tk_rt_topic_man_arrow"></div>                        <div class="tk_rt_topic_man_keyword_list">                        发言关键词：<br>'+t.top_keywords+'                        </div>                    </div>                </div>                <div class="clearfix"></div>            </div>'},_htmlUserLeft:function(t,_){var e="";return e+="<li>",e+='                <div class="tk_rt_number">TOP'+(t+1)+'</div>                <div class="tk_rt_user">                    昵称： '+_.author+"<br>                    QQ号："+_.qq_id+'                </div>                <div class="tk_rt_detail b_cursor"><i class="glyphicon glyphicon-list-alt"></i> 查看聊天内容（共 <span class="b_colorR">'+_.post_num+"</span>  条）</div>            </li>"}},F_ChatResult_Common={_openDetail:function(t,_){B_Pop._init("close");var e=0,o=0,a=[];a.push("id="+F_ChatResult_Info._id),a.push("s=10"),a.push("t="+t),_.word&&a.push("w="+encodeURIComponent(_.word)),_.qq&&a.push("q="+encodeURIComponent(_.qq)),_.author&&a.push("a="+encodeURIComponent(_.author)),_.relation&&a.push("r="+encodeURIComponent(_.relation));var i="outsidechatresult_s.html?"+a.join("&"),s="";switch(t){case"detail":s="关键词“"+_.word+"”的聊天记录",e="600px",o="550px";break;case"topic":s="“"+_.title+"”的相关的聊天会话",e="1130px",o="570px";break;case"user":s="聊天者“"+_.author+"（"+_.qq+"）”的聊天记录",e="800px",o="550px"}B_Pop._init("open",{type:2,scroll:!1,title:s,width:e,height:o,shift:2,content:i},"")}};