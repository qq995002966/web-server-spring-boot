var F_GameSentiment_Entrance={_init:function(e){if(B_Login._checkUpdate(),M_HeadFoot._headShow(2),M_Dom._menuList("游戏详情","7-2"),B_User._isDemoUser())B_Login._openLogin("background");else{M_Init._clean();var t=B_Common._getUrl("query");t.g?(M_Init._gameDetailId=t.g,B_Game._setLast(M_Init._gameDetailId,"outsideGameDetail")):e?(M_Init._gameDetailId=e,B_Game._setLast(M_Init._gameDetailId,"outsideGameDetail")):M_Init._gameDetailId||(M_Init._gameDetailId=M_Init._getGameId("outsideGameDetail")),M_Game._checkGameVisitList("gameSentiment")}}},F_GameSentiment_Info={_chartClick:function(e,t){var a={};switch(a.gameId=M_Init._gameDetailId,e){case"bs_word_tendency":case"bs_word_distribute":switch(M_Init._dateCache.tendencyType){case"tendencyNeutral":a.classifySentiment=2;break;case"tendencyPos":a.classifySentiment=1;break;default:a.classifySentiment=-1}a.lighttowerClassify=M_Init._dateCache.tendencyWord}switch(e){case"bs_word_tendency":a.dateBegin=t.date,a.dateEnd=t.date;break;case"bs_word_distribute":if(a.dateBegin=M_Init._dateCache.begin,a.dateEnd=M_Init._dateCache.end,M_Init._dateCache.feedback_tag_distri)for(var n=M_Init._dateCache.feedback_tag_distri,i=0;i<n.length;i++)if(n[i].show_tag==t.type){a.realTag=n[i].real_tag;break}break;case"bs_rank_detail_chart":a.dateBegin=t.date,a.dateEnd=t.date,a.keywords=M_Init._dateCache.rankWordCurrent}M_Outside._redirectForum(a)},_domInit:function(){var e="";e+='<div class="blockpart  col-lg-12 col-md-12 col-sm-12 col-xs-12  ">',e+="<h3>玩家反馈分析</h3>",e+='<div class="boxshadow  player-response">',e+='<div class="tg-selected-drop tg-date-fl"><span>日期</span>',e+='<p class="tg-drop-text-part">',e+='<i class="tg-graph tg-triangle-gray-bottom"></i>',e+='<span class="hot-area" id="dc1"></span>',e+='<input id="db1" type="hidden" value="">',e+='<input id="de1" type="hidden" value="">',e+="</div>",e+='<div class="wrap" id="bs_tendency">',e+="</div></div></div>",e+='<div class="blockpart  col-lg-12 col-md-12 col-sm-12 col-xs-12  ">',e+="<h3>热词排行榜</h3>",e+='<div class="boxshadow  player-response  hotword-rank">',e+='<div class="tg-selected-drop tg-date-fl"><span>日期</span>',e+='<p class="tg-drop-text-part">',e+='<i class="tg-graph tg-triangle-gray-bottom"></i>',e+='<span class="hot-area" id="dc2"></span>',e+='<input id="db2" type="hidden" value="">',e+='<input id="de2" type="hidden" value="">',e+="</div>",e+='<div class="wrap" id="bs_rank">',e+="</div></div></div>",e+='<div class="blockpart tg-table-layout col-lg-12 col-md-12 col-sm-12 col-xs-12  ">',e+="<h3>玩家话题排行榜</h3>",e+='<div class="boxshadow tg-table-content " id="playerTalkRank">',e+='<div class="tg-selected-drop tg-date-fl"><span>日期</span>',e+='<p class="tg-drop-text-part">',e+='<i class="tg-graph tg-triangle-gray-bottom"></i>',e+='<span class="hot-area" id="dc3"></span>',e+='<input id="db3" type="hidden" value="">',e+='<input id="de3" type="hidden" value="">',e+="</div>",e+='<div class="tg-table-wrap tg-height-hight">',e+='<div class="table-out-wrap" id="bs_topic_table"></div><ul class="tg-page-list" id="lt_forum_page"></ul>',e+="</div></div></div>",$("#ct_main_area").html(e),B_Date._chooseSection({autoCommit:!0,todayValid:!1},1,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(e,t){e==M_Init._dateCache.begin&&M_Init._dateCache.end==t||(M_Init._dateCache.begin=e,M_Init._dateCache.end=t,F_GameSentiment_Info._getTendency())}),B_Date._chooseSection({autoCommit:!0,todayValid:!1},2,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(e,t){e==M_Init._dateCache.begin2&&M_Init._dateCache.end2==t||(M_Init._dateCache.begin2=e,M_Init._dateCache.end2=t,F_GameSentiment_Info._getRank())}),B_Date._chooseSection({autoCommit:!0,todayValid:!1},3,M_Init._dateChoose.begin,M_Init._dateChoose.end,function(e,t){e==M_Init._dateCache.begin3&&M_Init._dateCache.end3==t||(M_Init._dateCache.begin3=e,M_Init._dateCache.end3=t,F_GameSentiment_Info._getTopic(1))})},_htmlTendencyChart:function(e){var t="";return t+="<div>",t+='<p>"'+e+'"反馈走势</p>',t+='<div class="graph-part" id="bs_word_tendency"></div>',t+="</div>",t+="<div>",t+='<p>"'+e+'"反馈分布</p>',t+='<div class="graph-part" id="bs_word_distribute"></div>',t+="</div>"},_htmlTendency:function(e){var t="";return t+='<div class="fl" id="bs_tendency_word">',t+='<ul class="vertical-tab-change">',t+='<li class="selected">',t+='<b class="color-a">'+e.neg+"%</b>",t+="<p>负面反馈占比</p>",t+="tendencyNeg"==M_Init._dateCache.tendencyType?'<i class="tg-icon triangle-shadow"></i>':"",t+="</li>",t+="<li>",t+='<b class="color-b">'+e.pos+"%</b>",t+="<p>正面反馈占比</p>",t+="tendencyPos"==M_Init._dateCache.tendencyType?'<i class="tg-icon triangle-shadow"></i>':"",t+="</li>",t+="<li>",t+='<b class="color-c">'+e.neutral+"%</b>",t+="<p>中性反馈占比</p>",t+="tendencyNeutral"==M_Init._dateCache.tendencyType?'<i class="tg-icon triangle-shadow"></i>':"",t+="</li>",t+="</ul>",t+='<ul class="problem-list" id="bs_tendency_detail"></ul>',t+="</div>",t+='<div class="graph-wrap" id="bs_tendency_chart">',t+="</div>"},_getTendency:function(){var e=$("#bs_tendency"),t={};t.start_date=M_Init._dateCache.begin,t.end_date=M_Init._dateCache.end,t.project_id=M_Init._gameDetailId,t=B_Common._postData(t),B_Port._ajax("feedbackAnalyse","get",!0,t,function(){e.html(B_Pre._loading())},function(){e.html("")},function(t,a){if(t&&t.feedback_class_distri){var n={neg:0,pos:0,neutral:0};n.neg=t.negative_rate?(100*t.negative_rate).toFixed(2):"0",n.pos=t.positive_rate?(100*t.positive_rate).toFixed(2):"0",n.neutral=t.other_rate?(100*t.other_rate).toFixed(2):"0",M_Init._dateCache.tendencyNeg=[],M_Init._dateCache.tendencyPos=[],M_Init._dateCache.tendencyNeutral=[],$.each(t.feedback_class_distri,function(e,t){switch(e+""){case"0":M_Init._dateCache.tendencyNeutral=t;break;case"-1":M_Init._dateCache.tendencyNeg=t;break;case"1":M_Init._dateCache.tendencyPos=t}}),M_Init._dateCache.tendencyType=M_Init._dateCache.tendencyType?M_Init._dateCache.tendencyType:"tendencyNeg",e.html(F_GameSentiment_Info._htmlTendency(n)),F_GameSentiment_Info._formatTendencyWord(),F_GameSentiment_Info._doTendencyTabChange()}else e.html(B_Pre._empty("暂无数据"))},function(t,a,n){e.html(B_Pre._empty(a))})},_doTendencyWordChange:function(){$("#bs_tendency_detail li").each(function(){$(this).click(function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings("li").removeClass("selected"),$(this).siblings("li").find("i").remove(),$(this).append('<i class="tg-icon triangle-shadow"></i>'),M_Init._dateCache.tendencyWord=$(this).find("span").html(),F_GameSentiment_Info._getTendencyChart())})})},_doTendencyTabChange:function(){$("#bs_tendency_word ul li").each(function(e){$(this).click(function(){if(!$(this).hasClass("selected")){switch($(this).addClass("selected").siblings("li").removeClass("selected"),$(this).siblings("li").find("i").remove(),$(this).append('<i class="tg-icon triangle-shadow"></i>'),e+""){case"0":M_Init._dateCache.tendencyType="tendencyNeg";break;case"1":M_Init._dateCache.tendencyType="tendencyPos";break;case"2":M_Init._dateCache.tendencyType="tendencyNeutral"}F_GameSentiment_Info._formatTendencyWord()}})})},_formatTendencyWord:function(){var e=M_Init._dateCache[M_Init._dateCache.tendencyType],t=!1,a="";if(e&&e.length>0){for(var n=1,i=0,d=0;d<e.length;d++)i+=parseInt(e[d].post_num);var _=0,s=0,c="rate",o=!1;switch(M_Init._dateCache.tendencyType){case"tendencyNeg":c="rate";for(var r={common:[],game:[]},d=0;d<e.length;d++)r[e[d].feedback_type].push(e[d]);r.common=e,M_Init._dateCache.tendencyNegType=M_Init._dateCache.tendencyNegType?M_Init._dateCache.tendencyNegType:"common",r.game.length>0&&(o=!0,a+="<p>",a+="game"==M_Init._dateCache.tendencyNegType?'<input type="checkbox" id="bs_common_game" checked />':'<input type="checkbox" id="bs_common_game" />',a+=" 仅看与产品相关</p>"),e=r[M_Init._dateCache.tendencyNegType];break;case"tendencyPos":c="rate green-rate";break;case"tendencyNeutral":c="rate blue-rate"}for(var d=0;d<e.length;d++)if("其它"!=e[d].lighttower_classify?(_=(parseInt(e[d].post_num)/i*100).toFixed(0),1==n?(M_Init._dateCache.tendencyWord=e[d].lighttower_classify,s=(100/_).toFixed(0),_=100,a+='<li class="selected">'):(_*=s,a+="<li>"),a+="<b>"+n+"</b>",a+="<span>"+e[d].lighttower_classify+"</span>",a+='<div class="koubei-percent-wrap">',a+='<div class="'+c+'" style="width:'+_+'%"></div>',a+="</div>",a+=1==n?'<i class="tg-icon triangle-shadow"></i>':"",a+="</li>",n++):t=!0,t){if(n>=10)break}else if(n>=11)break;t&&(1==n?(M_Init._dateCache.tendencyWord="其它",a+='<li class="selected">'):a+="<li>",a+="<b>"+n+"</b>",a+="<span>其它</span>",a+='<div class="koubei-percent-wrap">',a+='<div class="'+c+'" style="width:'+_+'%"></div>',a+="</div></li>"),a+="</div>"}a?($("#bs_tendency_detail").html(a),o&&($('input[type="checkbox"]').bootstrapSwitch("size","small"),$('input[type="checkbox"]').on("switchChange.bootstrapSwitch",function(e,t){t?M_Init._dateCache.tendencyNegType="game":M_Init._dateCache.tendencyNegType="common",F_GameSentiment_Info._formatTendencyWord()})),F_GameSentiment_Info._doTendencyWordChange(),F_GameSentiment_Info._getTendencyChart()):($("#bs_tendency_detail").html(B_Pre._empty("暂无数据")),$("#bs_tendency_chart").html(B_Pre._empty("暂无数据")))},_getTendencyChart:function(){var e=$("#bs_tendency_chart"),t=0,a={x_axis:[],y_axis:[],xFormatDate:!0},n=[];switch(M_Init._dateCache.tendencyType){case"tendencyNeg":a.color=["#f33f57"],t=-1;break;case"tendencyPos":a.color=["#73bd36"],t=1;break;case"tendencyNeutral":a.color=["#1862c9"],t=0}if(!M_Init._dateCache.tendencyWord)return void e.html(B_Pre._empty("暂无数据"));var i={};i.start_date=M_Init._dateCache.begin,i.end_date=M_Init._dateCache.end,i.project_id=M_Init._gameDetailId,i.classify_sentiment=t,i.lighttower_classify=M_Init._dateCache.tendencyWord,i=B_Common._postData(i),B_Port._ajax("feedbackAnalyseDetail","get",!0,i,function(){e.html(B_Pre._loading())},function(){e.html("")},function(t,i){e.html(F_GameSentiment_Info._htmlTendencyChart(M_Init._dateCache.tendencyWord));var d=$("#bs_word_tendency"),_=$("#bs_word_distribute");if(t&&t.feedback_date_distri&&t.feedback_date_distri.length>0){a.x_axis=[],a.y_axis=[],n=[];for(var s=0;s<t.feedback_date_distri.length;s++)a.x_axis.push(t.feedback_date_distri[s].data_date),n.push(t.feedback_date_distri[s].post_num);a.y_axis.push({name:"帖子数",data:n}),M_Outside_Chart._chartData("lineOpacity","bs_word_tendency",a)}else d.html(B_Pre._empty("暂无数据"));if(M_Init._dateCache.feedback_tag_distri=[],t&&t.feedback_tag_distri&&t.feedback_tag_distri.length>0){M_Init._dateCache.feedback_tag_distri=t.feedback_tag_distri,a.x_axis=[],a.y_axis=[],a.yFormat="%",a.xFormatDate=!1,n=[];for(var s=0;s<t.feedback_tag_distri.length;s++)a.x_axis.push(t.feedback_tag_distri[s].show_tag),n.push((100*t.feedback_tag_distri[s].tag_rate).toFixed(2));a.tooltip={num:1,unit:"%"},a.y_axis.push({name:"占比",data:n}),M_Outside_Chart._chartData("bar","bs_word_distribute",a)}else _.html(B_Pre._empty("暂无数据"))},function(t,a,n){e.html(B_Pre._empty(a))})},_htmlRank:function(e,t){var a="";a+='<div class="fl"><ul class="problem-list">';for(var n=0,i=1,d=0,_=!1,s="",c=0;c<e.length;c++)if("其他"!=e[c].word?(n=(parseInt(e[c].number)/t*100).toFixed(2),1==i?(d=(100/n).toFixed(0),n=100,a+='<li class="selected"><i class="tg-icon triangle-shadow"></i>',M_Init._dateCache.rankWord=e[c].word):(n*=d,a+="<li>"),a+="<b>"+i+'</b><span class="bs_rank_word_word">'+e[c].word+"</span><span>"+e[c].number+'条反馈</span><div class="koubei-percent-wrap"><div class="rate" style="width: '+n+'%"></div></div></li>',i++):(s=e[c],_=!0),_){if(i>=10)break}else if(i>=11)break;return _&&(a+="<li><b>"+i+'</b><span class="bs_rank_word_word">'+s.word+"</span><span>"+s.number+'条反馈</span><div class="koubei-percent-wrap"><div class="rate" style="width: '+n+'%"></div></div></li></li>'),a+="</ul></div>",a+='<div class="graph-wrap">',a+='<div id="bs_rank_show"></div>',a+="</div>"},_htmlRankDetail:function(){var e="";if(e+='<span class="control-icon pre-click"><i class="tg-graph"></i></span>',e+='<div id="bs_rank_detail">',e+='<ul class="tab-click-change">',M_Init._dateCache.rankWordDetail&&M_Init._dateCache.rankWordDetail[M_Init._dateCache.rankWord])for(var t=M_Init._dateCache.rankWordDetail[M_Init._dateCache.rankWord],a=0;a<t.length;a++)0==a?(e+='<li class="selected">',M_Init._dateCache.rankWordCurrent=t[a].keyword):e+="<li>",e+="<span>"+t[a].keyword+"</span><p>"+t[a].cnt+"反馈</p></li>";e+="</ul></div>",e+='<span class="control-icon next-click"><i class="tg-graph tg-triangle-gray-right"></i></span></div>',e+='<div><div class="graph-part boxshadow"><div  id="bs_rank_detail_chart" style="width: 100%;height: 100%"></div></div>',$("#bs_rank_show").html(e),M_Outside._clickScroll($("#bs_rank_show .pre-click"),$("#bs_rank_show .next-click"),$(".tab-click-change"),"",101,1,10,"selected-btn"),F_GameSentiment_Info._doRankTabChange(),F_GameSentiment_Info._getRankChart()},_getRank:function(){var e=$("#bs_rank"),t={};t.start_date=M_Init._dateCache.begin2,t.end_date=M_Init._dateCache.end2,t.project_id=M_Init._gameDetailId,t=B_Common._postData(t),B_Port._ajax("feedbackHotwords","get",!0,t,function(){e.html(B_Pre._loading())},function(){e.html("")},function(t,a){if(t&&t.length>0){for(var n=[],i={},d=0,_=0,s=0;s<t.length;s++)t[s].keywords&&(d=t[s].keywords.length,d>0&&(_+=t[s].cnt,n.push({word:t[s].keyword_classify,number:t[s].cnt}),d>50&&(t[s].keywords=t[s].keywords.slice(0,50)),i[t[s].keyword_classify]=t[s].keywords));n&&n.length>0?(M_Init._dateCache.rankWordDetail=i,e.html(F_GameSentiment_Info._htmlRank(n,_)),F_GameSentiment_Info._doRankWordChange(),F_GameSentiment_Info._htmlRankDetail()):e.html(B_Pre._empty("暂无数据"))}else e.html(B_Pre._empty("暂无数据"))},function(t,a,n){e.html(B_Pre._empty(a))})},_getRankChart:function(){var e=$("#bs_rank_detail_chart"),t={};t.keyword=M_Init._dateCache.rankWordCurrent,t.start_date=M_Init._dateCache.begin2,t.end_date=M_Init._dateCache.end2,t.project_id=M_Init._gameDetailId,t=B_Common._postData(t),B_Port._ajax("feedbackKeywords","get",!0,t,function(){e.html(B_Pre._loading())},function(){e.html("")},function(t,a){if(t&&t.y_axis&&t.y_axis.length>0){var n={x_axis:[],y_axis:[],xFormatDate:!0};n.x_axis=t.x_axis,n.y_axis.push({name:"帖子数",data:t.y_axis}),M_Outside_Chart._chartData("lineOpacity","bs_rank_detail_chart",n)}else e.html(B_Pre._empty("暂无数据"))},function(t,a,n){e.html(B_Pre._empty(a))})},_doRankWordChange:function(){$("#bs_rank .problem-list li").each(function(){$(this).click(function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings("li").removeClass("selected"),$(this).siblings("li").find("i").remove(),$(this).append('<i class="tg-icon triangle-shadow"></i>'),M_Init._dateCache.rankWord=$(this).find(".bs_rank_word_word").html(),F_GameSentiment_Info._htmlRankDetail())})})},_doRankTabChange:function(){$("#bs_rank_detail li").each(function(e){$(this).click(function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings("li").removeClass("selected"),M_Init._dateCache.rankWordCurrent=$(this).find("span").html(),F_GameSentiment_Info._getRankChart())})})},_searchTopic:function(e){M_Outside._redirectForum({gameId:M_Init._gameDetailId,dateBegin:M_Init._dateCache.begin3,dateEnd:M_Init._dateCache.end3,topicId:e})},_htmlTopic:function(e,t){var a="";a+='<table class="tg-table table table-bordered">',a+='<thead class="boxshadow">',a+="<tr>",a+='<th>排名</th><th class="game-tag">热门话题</th><th class="rate-num">热力指数</th><th>正面情感贴数</th><th>负面情感贴数</th><th>操作</th>',a+="<tr>",a+="</thead>",a+="<tbody>";for(var n=[],i=0;i<e.length;i++){if(0==i&&0==t?(M_Init._dateCache.hot_num_per_diff=Math.ceil(100/e[i].hot_num),e[i].hot_num=100):M_Init._dateCache.hot_num_per_diff&&(e[i].hot_num*=M_Init._dateCache.hot_num_per_diff),a+="<tr>",a+="<td>"+(t+i+1)+"</td>",a+='<td><ul class="tg-tab-btn">',e[i].topic_word_list&&(e[i].topic_word_list=$.trim(e[i].topic_word_list),e[i].topic_word_list)){n=e[i].topic_word_list.split(" ");for(var d=0;d<n.length;d++)a+='<li class="tg-tab-btn-normal">'+n[d]+"</li>"}a+="</ul></td>",a+='<td><div class="koubei-percent-wrap"><div class="rate" style="width: '+e[i].hot_num+'%"></div></div><span>'+e[i].post_num+"</span></td>",a+="<td>"+e[i].positive_num+"</td>",a+="<td>"+e[i].negative_num+"</td>",a+='<td><button class="tg-main-btn" onclick="F_GameSentiment_Info._searchTopic(\''+e[i].topic_id+"')\">查看详情</button></td>",a+="</tr>"}return a+="</tbody>",a+="</table>"},_getTopic:function(e){var t=$("#bs_topic_table"),a=$("#lt_forum_page"),n={};n.start_date=M_Init._dateCache.begin3,n.end_date=M_Init._dateCache.end3,n.project_id=M_Init._gameDetailId,n.index=(e-1)*B_Page._size,n.limit=B_Page._size,n=B_Common._postData(n),B_Port._ajax("feedbackRank","get",!0,n,function(){t.html(B_Pre._loading()),a.html("")},function(){t.html("")},function(n,i){n&&n.topic_distri&&n.topic_distri.length>0?(t.html(F_GameSentiment_Info._htmlTopic(n.topic_distri,(e-1)*B_Page._size)),a.html(B_Page._show({total:20,page:e},"number")),B_Page._click(e,function(e){F_GameSentiment_Info._getTopic(e)})):t.html(B_Pre._empty("暂无数据"))},function(e,a,n){t.html(B_Pre._empty(a))})}};