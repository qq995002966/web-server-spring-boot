require(["frontmain"],function(){require(["jquery","layer","base","front","store.min"],function(){store=require("store.min"),F_Bind_Entrance._init()})});var F_Bind_Entrance={_init:function(){B_Captcha._getCaptcha("div_gt_embed"),F_Bind._check(),F_Bind._sms(),B_Common._isInner()?F_Bind._getMobile():(B_Login._check(),B_User._isDemoUser()&&B_Jump._go("target","login"),S_HeadFoot._getLoginHead("手机绑定"),$(".h-logo").click(function(){B_Jump._go("target","index")})),B_Common._submitBind($("#bs_bind_btn"),$('input[name="usercode"],input[name="username"],input[name="userpass"],input[name="passcheck"]')),$('input[name="username"]').blur(function(){var n=$.trim($(this).val());""!=n&&B_Common._isMobile(n)?F_Bind._checkMobile(n):$("#bs_sms_send").attr("data-c",0)})}},F_Bind={_getMobile:function(n){B_Pop._init("load",{type:1,time:60,shade:[.6,"#000000"]}),B_Port._ajax("detailMobile","get",!0,null,null,null,function(n,i){B_Pop._init("close"),n.mobile&&""!=n.mobile&&($('input[name="username"]').val(n.mobile),F_Bind._checkMobile(n.mobile))},function(n,i,t){switch(t+""){case"-1049":B_Pop._init("checkAlert",{content:i,icon:2,closeBtn:!1,title:!1},function(){parent.B_Pop._init("close")})}return!1})},_checkMobile:function(n){B_Common._isInner()||F_Bind._notice(0,"");var i={};i.mobile=n,i=B_Common._postData(i),B_Port._ajax("checkMobile","get",!0,i,null,null,function(n,i){$("#bs_sms_send").attr("data-c",1)},function(n,i,t){return B_Common._isInner()?(B_Pop._init("confirm",{content:"该账号已注册，申请与QQ号（微信号）绑定！",btn:["确认绑定","取消"]},function(){B_Pop._init("close"),$("#bs_sms_send").attr("data-c",1)},function(){B_Pop._init("close"),parent.B_Pop._init("close")}),$(".layui-layer-dialog").css("left","15px"),!1):($("#bs_sms_send").attr("data-c",2),B_Pop._init("open",{content:F_Bind._htmlNotice()}),!1)})},_confirm:function(n){switch(n){case"c":$("#bs_sms_send").attr("data-c","3");break;case"q":$("#bs_sms_send").attr("data-c","2")}B_Pop._init("close")},_htmlNotice:function(){var n=B_Login._user.user,i="";n.qq_head?i=n.qq_head:n.wx_head&&(i=n.wx_head);var t='            <div class="connection-pop">                <div class="connection-content">                    <div class="top">                        <img src="'+i+'" alt="">                        <i class="change-arrow"></i>                        <img src="elements2.0/img/lr/default-pic.jpg" alt="">                    </div>                    <p>该手机号已注册，是否将QQ号（微信号）与该账号进行绑定</p>                    <div class="btn">                        <button class="main-btn" onclick="F_Bind._confirm(\'c\')">确认绑定</button>                        <button class="assist-btn" onclick="F_Bind._confirm(\'q\')">取消</button>                    </div>                </div>            </div>';return t},_check:function(){$("#bs_bind_btn").click(function(){if(F_Bind._checkForm()){var n=$.trim($('input[name="usercode"]').val());if(""==n)return F_Bind._notice(3,"请输入验证码"),!1;if(F_Bind._notice(3,""),n.length<4)return F_Bind._notice(3,"验证码错误，请确认"),!1;F_Bind._notice(3,""),F_Bind._bind()}})},_bind:function(){var n=$.trim($('input[name="username"]').val()),i=$.trim($('input[name="userpass"]').val()),t={};t.mobile=n,t.password=i,t.verify_code=$.trim($('input[name="usercode"]').val()),t=B_Common._postData(t),B_Port._ajax("bindMobile","post",!0,t,function(){$("#bs_bind_btn").html("绑定中,请稍等...").attr("disabled",!0)},function(){$("#bs_bind_btn").html("绑定手机号").attr("disabled",!1)},function(i,t){return B_Login._setStatus("out"),B_Storage._set("login",n),B_Pop._init("alert",{content:"已完成手机绑定"}),B_Common._isInner()?setTimeout(function(){B_Jump._go("reload")},1e3):setTimeout(function(){B_Jump._go("base",B_Login._loginBackUrl())},1e3),!1},function(n,i,t){return B_Pop._init("msg",{content:i}),!1})},_sms:function(){$("#bs_sms_send").click(function(){if(F_Bind._checkForm()){var n=$(this).attr("data-c");switch(n+""){case"0":return F_Bind._notice(0,"手机号验证失败"),!1;case"2":return B_Pop._init("open",{content:F_Bind._htmlNotice()}),!1}if(!B_CaptchaObj||!B_CaptchaObj.getValidate())return F_Bind._notice(3,"请滑动验证"),!1;F_Bind._notice(3,""),B_Captcha._getVCode($.trim($('input[name="username"]').val()))}})},_checkForm:function(){var n=$.trim($('input[name="username"]').val()),i=$.trim($('input[name="userpass"]').val()),t=$.trim($('input[name="passcheck"]').val());return""==n?(F_Bind._notice(0,"手机号不能为空"),!1):(F_Bind._notice(0,""),B_Common._isMobile(n)?(F_Bind._notice(0,""),""==i?(F_Bind._notice(1,"密码不能为空"),!1):(F_Bind._notice(1,""),i.length<6?(F_Bind._notice(1,"密码不能少于6位字符"),!1):(F_Bind._notice(1,""),i!=t?(F_Bind._notice(2,"再次输入的密码不同"),!1):(F_Bind._notice(2,""),0!=$('input[name="useragree"]').prop("checked")||(B_Pop._init("msg",{content:"请勾选并同意《隐私策略及服务条款》"}),!1))))):(F_Bind._notice(0,"手机号格式错误"),!1))},_notice:function(n,i){i&&B_Pop._init("msg",{content:i})}};