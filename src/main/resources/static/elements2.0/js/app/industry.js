require(["frontmain"],function(){require(["jquery","echarts","china","numbers","layer","base","front","store.min","app/outside"],function(){store=require("store.min"),echarts=require("echarts"),F_Industry_Entrance._init()})});var F_Industry_Entrance={_init:function(){B_Login._check(),S_HeadFoot._getHead(),S_HeadFoot._htmlPaper(),setInterval('F_Industry_Trend._getTrend("realtime")',6e4),F_Industry_Trend._getTrend("realtime"),setTimeout(function(){F_Industry_GameMap._getMap()},200),setTimeout(function(){F_Industry_GameMap._getContent()},400),setTimeout(function(){F_Industry_Type._getType()},600),setTimeout(function(){F_Industry_Complain._getComplain("手游")},800),setTimeout(function(){F_Industry_AppStore._getApp()},1e3),F_Industry_Common._clickChoose("bs_app_type",function(t){F_Industry_AppStore._getApp()}),F_Industry_Common._clickChoose("bs_app_device",function(t){F_Industry_AppStore._getApp()})}},F_Industry_Common={_cache:{},_clickChoose:function(t,e){$("."+t+" li").each(function(){$(this).click(function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings("li").removeClass("selected"),e&&e($(this).html()))})})}},F_Industry_AppStore={_more:function(t){var e=F_Industry_AppStore._getCondition("more");window.open("rank.html?"+e+"&c="+B_Common._encodeUrl(t))},_getCondition:function(t){var e="",a="";$(".bs_app_type li").each(function(){$(this).hasClass("selected")&&(a=$(this).attr("data-i"))}),$(".bs_app_device li").each(function(){$(this).hasClass("selected")&&(e=$(this).attr("data-i"))});var n={};switch(t){case"more":n.p=e,n.t=a,n.d=B_Date._getDiffDate(null,-1);break;default:n.device_type=e,n.list_type=a,n.data_date=B_Date._getDiffDate(null,-1)}return B_Common._postData(n)},_getApp:function(){var t=$("#bs_appStore");B_Port._ajax("industryAppStore","get",!0,F_Industry_AppStore._getCondition(),function(){t.html(B_Pre._loading())},function(){t.html("")},function(t,e){t.appstore_type_distri&&F_Industry_AppStore._chartApp(t.appstore_type_distri)},function(e,a,n){t.html(B_Pre._empty(a))})},_chartApp:function(t){for(var e={x_axis:[],y_axis:[{data:[],name:"数量"}]},a="",n=0;n<t.length;n++)M_Game._appGameType[t[n].app_type]&&(a=M_Game._appGameType[t[n].app_type],"小游戏"!=a&&(a=a.replace("游戏","")),e.x_axis.push(a),e.y_axis[0].data.push(t[n].app_num));S_Chart._chartData("bar","bs_appStore",e,"appStoreRank")}},F_Industry_Type={_getType:function(){var t=$("#bs_type_chart");B_Port._ajax("industryTypeDistri","get",!0,null,function(){t.html(B_Pre._loading())},function(){t.html("")},function(t,e){t.type_num_distri&&F_Industry_Type._htmlTypeList(t.type_num_distri)},function(e,a,n){t.html(B_Pre._empty(a))})},_htmlTypeList:function(t){for(var e={x_axis:[],y_name:[],y_axis:[{data:[],name:"占比(%)"}],legendSelectMode:!0,inverse:!0,xSplitLine:!0},a="",n=0,_=0,i=[["手游","#72C4FF"],["页游","#BFA4F1"],["端游","#FFA6A5"],["单机","#AEDD8C"]],s=0;s<i.length;s++)if(a=t[i[s][0]]){e.y_name.push(i[s][0]);for(var r=0;r<a.length;r++)0==s?(n=r,e.x_axis.push(a[r].detail_type)):n=$.inArray(a[r].detail_type,e.x_axis),n>-1&&(_=parseInt(100*a[r].game_rate).toFixed(0),e.y_axis[0].data.push({value:[n,s,_],itemStyle:{normal:{color:i[s][1]}}}))}F_Industry_Common._cache.typePlat=e.y_name,F_Industry_Common._cache.typeClassify=e.x_axis,S_Chart._chartData("scatter","bs_type_chart",e)}},F_Industry_Complain={_htmlComplain:function(){var t="";return t+='            <div class="left">                <ul class="tab-change bs_complain_choose">                    <li class="selected">手游</li>                    <li>页游</li>                    <li>端游</li>                    <li>单机</li>                </ul>                <ul class="list bs_complain_list"></ul>            </div>            <img src="elements2.0/img/y.png" class="y-img">            <div class="graph-part cursor-default">                <div id="bs_complain_chart" style="width: 100%; height: 100%"></div>            </div>            <img src="elements2.0/img/x.png" class="x-img">'},_getComplain:function(t){if(F_Industry_Common._cache.complain)F_Industry_Complain._htmlComplainList(t,F_Industry_Common._cache.complain[t]);else{var e=$("#bs_complain");B_Port._ajax("industryComplain","get",!0,null,function(){e.html(B_Pre._loading())},function(){e.html("")},function(a,n){a.negtive_distri_all&&(F_Industry_Common._cache.complain=a.negtive_distri_all,e.html(F_Industry_Complain._htmlComplain()),F_Industry_Complain._htmlComplainList(t,a.negtive_distri_all[t]),F_Industry_Common._clickChoose("bs_complain_choose",function(t){F_Industry_Complain._getComplain(t)}))},function(t,a,n){e.html(B_Pre._empty(a))})}},_htmlComplainList:function(t,e){for(var a=0,n=0,_="",i="",s="",r=0;r<e.length;r++)a=(100*e[r].complain_rate).toFixed(1),n=100-a,i=0==r?' class="selected"':"",0==r&&(s=e[r].detail_type),_+='            <li data-i="'+e[r].detail_type+'"'+i+'>                <div class="left-part">                    <span>'+e[r].detail_type+"</span>                    <i>"+a+'%</i>                </div>                <div class="rate-wrap">                    <div class="rate" style="width: '+n+'%"></div>                </div>            </li>';$(".bs_complain_list").html(_),F_Industry_Complain._chartComplain(t,s),$(".bs_complain_list li").each(function(){$(this).click(function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings().removeClass("selected"),F_Industry_Complain._chartComplain(t,$(this).attr("data-i")))})})},_chartComplain:function(t,e){var a=$("#bs_complain_chart"),n={};n.platform=t,n.detail_type=e,n=B_Common._postData(n),B_Port._ajax("industryComplainDetail","get",!0,n,function(){a.html(B_Pre._loading())},function(){a.html("")},function(t,e){if(t&&t.data&&t.data.length>0){for(var a=t.data,n={data:{data:[],name:"抱怨度(%)"},xMax:t.max_index,color:["#ec644c"],xSplitLine:!0},_=0;_<a.length;_++)n.data.data.push([a[_].hot_index,a[_].complain_rate]);S_Chart._chartData("scatterType","bs_complain_chart",n)}},function(t,e,n){a.html(B_Pre._empty(e))})}},F_Industry_GameMap={_getMap:function(){var t=$("#bs_map_chart");B_Port._ajax("industryUserProvince","get",!0,null,function(){t.html(B_Pre._loading())},function(){t.html("")},function(t,e){if(t.province_distri&&t.province_distri.length>0){for(var a={x_axis:[],y_axis:[{data:[],name:"活跃玩家占比(%)"}],visualMax:0},n=0;n<t.province_distri.length;n++){var _=(100*t.province_distri[n].active_rate).toFixed(1);a.y_axis[0].data.push({name:t.province_distri[n].province,value:_}),parseFloat(_)>parseFloat(a.visualMax)&&(a.visualMax=_)}a.visualMax=Math.ceil(a.visualMax),S_Chart._chartData("map","bs_map_chart",a)}},function(e,a,n){t.html(B_Pre._empty(a))})},_getContent:function(){var t=$("#bs_content_list");""==t.html()?F_Industry_GameMap._contentPort(1):F_Industry_Common._cache.contentData&&F_Industry_Common._cache.contentData.length>0&&(t.find("li").eq(8).remove(),t.prepend(F_Industry_GameMap._htmlContent(F_Industry_Common._cache.contentData[0])),F_Industry_Common._cache.contentData=F_Industry_Common._cache.contentData.slice(1),F_Industry_Common._cache.contentData.length<10&&F_Industry_GameMap._contentPort(2))},_contentPort:function(t){var e=$("#bs_content_list");B_Port._ajax("countryDetail","get",!0,null,function(){1==t&&e.html(B_Pre._loading())},function(){1==t&&e.html("")},function(a,n){if(a&&a.content_list&&a.content_list.length>0)if(1==t){for(var _=a.content_list.length,i="",s=0;s<_&&9!=s;s++)i+=F_Industry_GameMap._htmlContent(a.content_list[s]);e.html(i),_>9&&(F_Industry_Common._cache.contentData=a.content_list.slice(9),listInterval=setInterval("F_Industry_GameMap._getContent()",1e3))}else a.content_list&&a.content_list.length>15?F_Industry_Common._cache.contentData=a.content_list:clearInterval(listInterval)},function(t,a,n){e.html(B_Pre._empty(a))})},_htmlContent:function(t){var e="";return e+='            <li>                <div class="title">                <img src="'+B_Common._cdnImgUrl()+t.image+'">                <div class="des">                <span>'+t.source+"</span>                <b>"+t.author+'</b>                </div>                </div>                <div class="content">                <span>'+t.post_datetime+"</span>                <p>"+t.content+"</p>                </div>            </li>"}},F_Industry_Trend={_clickTab:function(){$(".bs_trend_type li").each(function(t){$(this).click(function(){if(!$(this).hasClass("selected"))switch($(this).addClass("selected").siblings("li").removeClass("selected"),t+""){case"0":$("#bs_trend_chart").show(),$("#bs_trendDay_chart").hide();break;case"1":$("#bs_trend_chart").hide(),$("#bs_trendDay_chart").show(),F_Industry_Trend._getTrend("forum")}})}),$(".bs_trend_tab li").each(function(t){$(this).click(function(){if(!$(this).hasClass("selected"))switch($(this).addClass("selected").siblings("li").removeClass("selected"),t+""){case"0":$(".bs_trend_type").show();var e="";switch($(".bs_trend_type li").each(function(t){$(this).hasClass("selected")&&(e=t)}),e+""){case"0":$("#bs_trend_chart").show(),$("#bs_trendDay_chart").hide();break;case"1":$("#bs_trendDay_chart").show(),$("#bs_trend_chart").hide(),F_Industry_Trend._getTrend("forum")}break;case"1":case"2":switch($("#bs_trendDay_chart").show(),$(".bs_trend_type").hide(),$("#bs_trend_chart").hide(),t+""){case"1":F_Industry_Trend._getTrend("channel");break;case"2":F_Industry_Trend._getTrend("article")}}})})},_getTrend:function(t){if("realtime"!=t&&F_Industry_Common._cache.trendDay)F_Industry_Trend._formatPublish(t);else{var e="",a="";switch(t){case"realtime":e=$("#bs_trend_chart"),a="realtime";break;case"forum":case"channel":case"article":e=$("#bs_trendDay_chart"),a="day"}var n={};n.scope=a,n=B_Common._postData(n),B_Port._ajax("industryGeneral","get",!0,n,function(){switch(t){case"realtime":break;default:e.html(B_Pre._loading())}},function(){e.html("")},function(e,a){if(e)switch(t){case"realtime":F_Industry_Trend._formatActive(e);break;case"forum":case"channel":case"article":F_Industry_Common._cache.trendDay=e.industry_distri_day,F_Industry_Trend._formatPublish(t)}F_Industry_Trend._clickTab()},function(){e.html(B_Pre._empty(msg))})}},_formatActive:function(t){F_Industry_Common._cache.rand=t.title_distri_realtime&&t.title_distri_realtime.length>0?t.title_distri_realtime[t.title_distri_realtime.length-1].title_num:0;var e=parseInt(t.title_num_today_total)-parseInt(F_Industry_Common._cache.rand);if(F_Industry_Common._cache.number=e<0?F_Industry_Common._cache.rand:e,F_Industry_Trend._htmlNumber(t),F_Industry_Trend._effectNumber(),t.title_distri_realtime&&t.title_distri_realtime.length>0){F_Industry_Common._cache.allDate=[],F_Industry_Common._cache.allData=[];for(var a={x_axis:[],y_axis:[{data:[],name:"发帖数"}],yMax:0,yMin:1e9},n=t.title_distri_realtime,_=0,i=1e9,s=0;s<n.length;s++){var r=n[s].data_time.toString().replace(":00","");s<30&&(a.x_axis.push(r),a.y_axis[0].data.push(n[s].title_num)),_=_>parseInt(n[s].title_num)?_:n[s].title_num,i=i<parseInt(n[s].title_num)?i:n[s].title_num,F_Industry_Common._cache.allDate.push(r),F_Industry_Common._cache.allData.push(n[s].title_num)}a.yMax=(1.2*_).toFixed(0),a.yMin=(i/1.5).toFixed(0),S_Chart._chartData("lineActive","bs_trend_chart",a)}},_formatPublish:function(t){if(F_Industry_Common._cache.trendDay){var e=F_Industry_Common._cache.trendDay,a={x_axis:[],y_axis:[{data:[],name:"发布数"}],xFormatDate:!0},n="";switch(t){case"forum":n="forum_post_num";break;case"channel":n="chan_post_num";break;case"article":n="article_post_num"}for(var _=0,i=0,s=0;s<e.length;s++)i=parseInt(e[s][n]),_<i&&(_=i),a.x_axis.push(e[s].data_date),a.y_axis[0].data.push(i);"forum"==t&&(a.yMax=2*_),S_Chart._chartData("line","bs_trendDay_chart",a)}},_formatPercent:function(t,e){t=parseInt(t),e=parseInt(e);var a=(100*(t/e-1)).toFixed(2);return t>=e?"+"+a+"%":a+"%"},_htmlNumber:function(t){$(".bs_trend_tab li").each(function(e){var a=0,n=0,_=0,i=0;switch(e){case 0:a=F_Industry_Trend._formatPercent(t.title_num_today_total,t.title_num_yesterday_basis),_=t.title_num_yesterday_basis,i=t.title_num_yesterday_total;break;case 1:a=F_Industry_Trend._formatPercent(t.channel_num_today_total,t.channel_num_yesterday_basis),n=t.channel_num_today_total,_=t.channel_num_yesterday_basis,i=t.channel_num_yesterday_total;break;case 2:a=F_Industry_Trend._formatPercent(t.article_num_today_total,t.article_num_yesterday_basis),n=t.article_num_today_total,_=t.article_num_yesterday_basis,i=t.article_num_yesterday_total}0==e?"":$(this).find("b").html(n),$(this).find("i").html(a),parseFloat(a)>0?$(this).find("i").addClass("positive"):parseFloat(a)<0&&$(this).find("i").addClass("negative"),$(this).find(".post-num-compare").html("昨日同比发布数:<b>"+_+"</b>"),$(this).find(".post-num-all").html("昨日全天发布数:<b>"+i+"</b>")})},_effectNumber:function(){F_Industry_Common._cache.number=parseInt(F_Industry_Common._cache.number),F_Industry_Common._cache.rand=parseInt(F_Industry_Common._cache.rand);var t=$(".bs_change_number").numberAnimate({num:F_Industry_Common._cache.number,speed:2e3});if($(".mt-number-animate").css("margin-top","0px"),F_Industry_Common._cache.rand>0){var e=Math.ceil(F_Industry_Common._cache.rand/2),a=Math.floor(e/60),n=F_Industry_Common._cache.rand-e,_=n;setInterval(function(){var e=Math.ceil(Math.random()*_);_-=e,F_Industry_Common._cache.number+=a+e,t.resetData(F_Industry_Common._cache.number)},5e3)}}};