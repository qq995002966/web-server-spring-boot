require(["frontmain"],function(){require(["jquery","layer","base","front","store.min"],function(){store=require("store.min"),F_Search_Entrance._init()})});var F_Search_Entrance={_cache:{},_init:function(){B_Login._check(),S_HeadFoot._getHead(),S_HeadFoot._htmlPaper();var e=B_Common._getUrl("query");if(!e.k)return void B_Pop._init("alert",{content:"搜索关键词必须填写,请确认！"});if(F_Search._cache.keyword=B_Common._decodeUrl(e.k),$('.login-part input[name="k"]').val(F_Search._cache.keyword),e.t){switch(F_Search._cache.type=e.t,e.t){case"k":break;default:if(!e.d)return void B_Pop._init("alert",{content:"搜索关键词必须填写,请确认！"});F_Search._cache.identify=B_Common._decodeUrl(e.d)}$("#searchresultPart .tab-change li").eq(1).addClass("selected").siblings().removeClass("selected"),$("#bs_search_game").hide(),$("#bs_search_article").show()}F_Search._typeChange(),F_Search._gameList(1),F_Search._cache.classify=S_Article._getClassify(),F_Search._articleList(1,e.t)}},F_Search={_cache:{keyword:"",identify:"",mainClass:"",subClass:"",classifyNumber:"",type:""},_typeChange:function(){$("#searchresultPart .tab-change li").each(function(e){$(this).click(function(){if(!$(this).hasClass("selected"))switch($(this).addClass("selected").siblings().removeClass("selected"),e+""){case"0":$("#bs_search_game").show(),$("#bs_search_article").hide();break;case"1":$("#bs_search_game").hide(),$("#bs_search_article").show()}})})},_redirect:function(e,a,t){switch(e){case"w":B_Jump._go("base",B_Jump._getUrl("search")+"?k="+B_Common._encodeUrl(a));break;case"l":if(B_User._isDemoUser())B_Login._openLogin(e+"_"+a);else if(B_Game._checkAuthGame(a)){var c=B_Jump._getUrl("gameLight",{gameId:a});B_Jump._go("base",c)}else B_Login._openProbation("game&gameId="+a)}},_tabTotalNumber:function(e,a){switch(e+""){case"0":$("#bs_search_game_total").html(a);break;case"1":$("#bs_search_article_total").html(a)}$("#searchresultPart .tab-change li").eq(e).find("b").html(a)},_gameList:function(e){var a=$("#bs_search_list"),t=$("#bs_search_game_page"),c=$("#bs_search_other"),s=$("#bs_search_game .search-text-show"),_={};_.keyword=F_Search._cache.keyword,_.index=(e-1)*B_Page._size,_.limit=B_Page._size,_=B_Common._postData(_),B_Port._ajax("projectReputationSearch","get",!0,_,function(){a.html(B_Pre._loading()),t.html(""),c.html("")},function(){a.html("")},function(_,i){var r=!1;if(_&&_.project_list&&_.project_list.length>0?(F_Search._tabTotalNumber(0,_.total),a.html(F_Search._htmlGameDetail(_.project_list,_.total)),t.html(B_Page._show({total:_.total,page:e},"page")),B_Page._click(e,function(e){F_Search._gameList(e)},"bs_search_game_page"),""==s.html()&&s.show().html('<p class="search-text-show">搜索"<b>'+F_Search._cache.keyword+'</b>"的结果共有"<b>'+_.total+'</b>"个游戏有口碑分析结果</p>')):r=!0,_&&_.other_list&&_.other_list.length>0){var l=_.other_list.length;B_Page._size*e>=_.total&&(0==_.total&&F_Search._tabTotalNumber(0,l),c.html(F_Search._htmlGameOther(_.other_list,l))),$(".bs_add_game").click(function(){B_Login._openPlan($(this).attr("data-i"))})}else r&&(F_Search._tabTotalNumber(0,0),a.html(B_Game._searchEmpty(F_Search._cache.keyword)))},function(e,t,c){a.html(B_Pre._empty(t))})},_htmlGameDetail:function(e,a){for(var t="",c="",s="",_=0;_<e.length;_++){if(c=B_Game._getGame([e[_].project_id])){if(c=c[e[_].project_id],t+='<div class="boxshadow"><ul class="game-list"><li>',t+='<div class="fl"><img src="'+c[0]+'" alt="'+c[1]+"\" onclick=\"F_Search._redirect('l',"+e[_].project_id+')">',t+="<p onclick=\"F_Search._redirect('l',"+e[_].project_id+')">'+B_Common._focusKeywords(F_Search._cache.keyword,c[1])+"</p>",t+="<span>游戏类型："+e[_].game_type+"</span>",t+="<span>开发商："+e[_].author+"</span>",t+="<span>发行商："+e[_].distributor+"</span>",t+="<span>发行日期："+e[_].release_date+"</span>",t+='<ul class="tg-tab-btn">',e[_].tag_list){s=B_Game._tag(e[_].tag_list);for(var i=0;i<e[_].tag_list.length;i++)s[e[_].tag_list[i]]&&(t+="<li class=\"tg-tab-btn-normal\" onclick=\"F_Search._redirect('w','"+s[e[_].tag_list[i]]+"');\">"+s[e[_].tag_list[i]]+"</li>")}t+="</ul></div>",t+='<ul class="fr">',t+='<li><span><b class="color-blue">'+e[_].hot_rank+"</b></span><p>ThinkingGame舆情榜</p></li>",t+='<li><span><b class="color-blue">'+e[_].app_rank+"</b></span><p>Appstore畅销榜</p></li>",t+='<li><button class="tg-main-btn" onclick="F_Search._redirect(\'l\','+e[_].project_id+')">查看口碑</button></li>',t+="</ul>"}t+="</li></ul></div>"}return t},_htmlGameOther:function(e,a){var t="";t+='<p class="search-text-show">搜索"<b>'+F_Search._cache.keyword+'</b>"的结果共有"<b>'+a+'</b>"个游戏暂时没有口碑分析结果</p>';for(var c="",s=0;s<e.length;s++)c=B_Game._getGame([e[s].project_id]),c&&(c=c[e[s].project_id],t+='<div class="boxshadow"><ul class="game-list"><li>',t+='<div class="fl"><img src="'+e[s].app_img+'" alt="'+e[s].app_name+'">',t+="<p>"+B_Common._focusKeywords(F_Search._cache.keyword,e[s].app_name)+"</p>",t+="<span>开发商："+e[s].app_author+"</span>",t+="</div>",t+='<ul class="fr">',t+='<li><button class="tg-main-btn bs_add_game" data-i="'+e[s].app_name+'">申请增加游戏</button></li>',t+="</ul>"),t+="</li></ul></div>";return t},_articleHtmlInit:function(e){var a="";switch(e){case"t":case"p":case"k":a+='<ul class="right" style="margin-left: 0">';break;default:a+='<ul class="left">',a+="</ul>",a+='<ul class="right"><div class="tab-change b_none"></div>'}var t='<p>搜索"<b>'+F_Search._cache.keyword+'</b>"的相关的媒体文章<b id="bs_search_article_total"></b>篇</p>';return t+='<div class="boxshadow content-wrap">',t+=a,t+='<ul id="bs_search_article_list"></ul><ul class="page-list" id="bs_search_article_page"></ul>',t+="</ul>",t+="</div>"},_articleList:function(e,a){""==$("#bs_search_article").html()&&$("#bs_search_article").html(F_Search._articleHtmlInit(a));var t={};switch(t.index=(e-1)*B_Page._size,t.limit=B_Page._size,t.need_preview=1,a){case"t":t.topic_id=F_Search._cache.identify,t.data_date_start=B_Date._getDiffDate(null,-29),t.data_date_end=B_Date._getDiffDate(null,0);break;case"p":t.project_id=F_Search._cache.identify;break;default:t.keyword=F_Search._cache.keyword,""!=F_Search._cache.mainClass&&(t.main_class=F_Search._cache.mainClass),""!=F_Search._cache.subClass&&(t.sub_class=F_Search._cache.subClass)}t=B_Common._postData(t);var c=$("#bs_search_article_list"),s=$("#bs_search_article_page");B_Port._ajax("articleList","get",!0,t,function(){c.html(B_Pre._loading("c_padding30")),s.html("")},function(){c.html(""),s.html("")},function(t,_){var i=0;if(t.data&&t.data.list.length>0){var i=t.data.total;a||""!=$("#bs_search_article .left").html()||F_Search._articleClassifyCount(),F_Search._htmlArticleList(t.data),s.html(B_Page._show({total:i,page:e},"page")),B_Page._click(e,function(e){F_Search._articleList(e,a)},"bs_search_article_page")}else F_Search._articleClassifyShowOrHide("hide"),c.html(F_Search._articleSearchEmpty(F_Search._cache.keyword));""==F_Search._cache.mainClass&&F_Search._tabTotalNumber(1,i)},function(e,a,t){c.html(B_Pre._empty(a))})},_articleSearchEmpty:function(e){return'            <div class="b_empty">              <div class="des">                <img src="elements2.0/img/empty.png" alt="">                <span>没有找到与"'+e+'"相关的文章</span>              </div>            </div>'},_articleClassifyShowOrHide:function(e){switch(e){case"hide":$("#bs_search_article .left").hide(),$("#bs_search_article .right .tab-change").hide(),$("#bs_search_article .right").css({"margin-left":0});break;case"show":$("#bs_search_article .left").show(),$("#bs_search_article .right .tab-change").hide(),$("#bs_search_article .right").css({"margin-left":""})}},_articleClassifyCount:function(){var e={};e.keyword=F_Search._cache.keyword,e=B_Common._postData(e),B_Port._ajax("articleClassifyCount","get",!0,e,null,null,function(e,a){e&&!B_Common._checkObjectIsEmpty(e)?(F_Search._articleClassifyShowOrHide("show"),F_Search._cache.classifyNumber=e,F_Search._htmlArticleClassifyBig()):F_Search._articleClassifyShowOrHide("hide")},function(e,a,t){F_Search._articleClassifyShowOrHide("hide")})},_htmlArticleClassifyBig:function(){var e=["公司","前沿","研发","行业","电竞","人物","游戏","其他"],a="";if(F_Search._cache.classifyNumber){for(var t=0;t<e.length;t++)F_Search._cache.classify[e[t]]?F_Search._cache.classify[e[t]]:F_Search._cache.classify["其他"],F_Search._cache.classifyNumber[e[t]]&&(a+='<li data-t="'+e[t]+'">',a+=e[t]+"("+F_Search._cache.classifyNumber[e[t]].total_num+")</li>");var c=$("#bs_search_article .left");c.html(a),c.find("li").each(function(){$(this).click(function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings().removeClass("selected"),$(this).siblings("li").find(".triangle-icon").remove(),$(this).append('<i class="triangle-icon tf-icon"></i>'),F_Search._cache.mainClass=$(this).attr("data-t"),F_Search._articleList(1,F_Search._cache.type),F_Search._htmlArticleClassifySmall())})})}},_htmlArticleClassifySmall:function(){var e=$("#bs_search_article .right .tab-change");if(F_Search._cache.classifyNumber&&F_Search._cache.mainClass&&F_Search._cache.classifyNumber[F_Search._cache.mainClass]&&F_Search._cache.classifyNumber[F_Search._cache.mainClass].sub_list){for(var a=F_Search._cache.classifyNumber[F_Search._cache.mainClass].sub_list,t='<span class="selected" data-t="全部">全部</span>',c=0;c<a.length;c++)$.each(a[c],function(e,a){t+='<span data-t="'+e+'">'+e+"("+a+")</span>"});e.html(t).show(),e.find("span").each(function(){$(this).click(function(){if(!$(this).hasClass("selected")){$(this).addClass("selected").siblings().removeClass("selected");var e=$(this).attr("data-t");F_Search._cache.subClass="全部"==e?"":e,F_Search._articleList(1,F_Search._cache.type)}})})}else e.html("").hide()},_htmlArticleList:function(e){for(var a="",t=[],c=e.list,s=0;s<c.length;s++)c[s].source.main_class||(c[s].source.main_class="其他"),t=F_Search._cache.classify[c[s].source.main_class]?F_Search._cache.classify[c[s].source.main_class]:F_Search._cache.classify["其他"],a+="<li>",a+='<a href="'+S_Article._detailUrl(c[s].id)+'" target="_blank">',a+=S_Article._previewImg(c[s].source.preview_img,c[s].source.source),a+="</a>",a+='<div class="des">',a+='<h3><a href="'+S_Article._detailUrl(c[s].id)+'"  target="_blank" title="'+c[s].source.title+'">'+B_Common._focusKeywords(F_Search._cache.keyword,c[s].source.title)+"</a></h3>",a+="<p>"+B_Common._focusKeywords(F_Search._cache.keyword,c[s].source.content)+"</p>",a+="<div>",t&&t.img&&(a+='<i class="'+t.img.styleClass+' b_img"></i>'),a+="<span>"+c[s].source.main_class+"</span><span>"+S_Article._getSource(c[s].source.source)+'</span><span class="date">'+c[s].source.post_date+"</span></div>",a+="</li>";setTimeout(function(){$("#bs_search_article_list").html(a)},200)}};