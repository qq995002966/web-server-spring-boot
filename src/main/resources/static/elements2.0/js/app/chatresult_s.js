requirejs.config({shim:{layer:["jquery"],"store.min":["jquery"],background:{deps:["base"]}},baseUrl:"elements2.0/js/lib",paths:{jquery:"./jquery-1.9.1.min",app:"../app",base:"../app/base",background:"../app/background"}}),require(["jquery","layer","store.min","base","background","app/outside"],function(){if(store=require("store.min"),B_Login._checkUpdate(),B_User._isDemoUser())parent.B_Login._openLogin("background");else{var t={},s=B_Common._getUrl("query");if(isNaN(s.id))return B_Pop._init("msg",{content:"选择的数据不存在"}),!1;switch(M_Init._dataCache.DetailInfoId=s.id,s.t){case"detail":if(!s.w||isNaN(s.s))return B_Pop._init("msg",{content:"查看的数据不存在"}),!1;s.w=B_Common._decodeUrl(s.w),t.keywords=s.w,t.source_type=s.s,t=B_Common._postData(t),F_ChatResult_Info._getDetail($("#bs_detail"),1,t.join("&"),s.w),$("#bs_detail").show();break;case"user":if(isNaN(s.s)||!s.a||!s.q)return B_Pop._init("msg",{content:"查看的数据不存在"}),!1;s.a=B_Common._decodeUrl(s.a),s.q=B_Common._decodeUrl(s.q),t.qq_id=s.q,t.author=s.a,t.source_type=s.s,t=B_Common._postData(t),F_ChatResult_Info._getDetail($("#bs_user .tk_rts_list"),1,t.join("&"));var _="";s.r&&(_=B_Common._decodeUrl(s.r),_=_.split(" "),_=_.join("<br>")),$(".tk_rt_topic_man_keyword_list").html("发言关键词：<br>"+_),$("#bs_user").show();break;case"topic":if(isNaN(s.s)||!s.w)return B_Pop._init("msg",{content:"查看的数据不存在"}),!1;s.w=B_Common._decodeUrl(s.w),F_ChatResult_Info._getSession(s.w,s.s),$("#bs_topic").show()}}});var F_ChatResult_Info={_getDetail:function(t,s,_,i,a){var e=(s-1)*B_Page._size,o={};o.info_id=M_Init._dataCache.DetailInfoId,o.index=e,o.limit=B_Page._size,o=B_Common._postData(o),B_Port._ajax("talkQueryPost","get",!0,_+"&"+o,function(){1==s?t.html(B_Pre._loading()):t.find(".tk_rt_topic_man_more span").unbind("click").html("加载中...")},function(){1==s&&t.html("")},function(e,o){if(e.data.list&&e.data.list.length>0){var n=s*B_Page._size>=e.data.total;switch(t.find(".tk_rt_topic_man_more").remove(),a){case"topic":t.append(F_ChatResult_Info._htmlTopic(e.data.list,n));break;default:t.append(F_ChatResult_Info._htmlDetail(e.data.list,n,i))}n?t.find(".tk_rt_topic_man_more span").unbind("click"):t.find(".tk_rt_topic_man_more span").bind("click",function(){F_ChatResult_Info._getDetail(t,s+1,_,i,a)}).addClass("c_cursor")}else 1==s&&t.html("暂无数据")},function(_,i,a){1==s&&t.html(B_Pre._empty(i))})},_getSession:function(t,s){var _=$("#bs_topic_list"),i={};i.index=0,i.limit=5,i.topic_id=t,i.info_id=M_Init._dataCache.DetailInfoId,i=B_Common._postData(i),B_Port._ajax("talkTopic","get",!0,i,function(){_.html(B_Pre._loading())},function(){_.html("")},function(i,a){if(i.get&&i.get.length>0){for(var e="<ul>",o="",n=0;n<i.get.length;n++)0==n&&(o=i.get[n].session_id),e+=F_ChatResult_Info._htmlSession(i.get[n],n,s);e+="</ul>",_.html(e),""!=o&&F_ChatResult_Info._getSessionDetail(t,o,s),$("#bs_topic li").each(function(t){$(this).click(function(){if(!$(this).hasClass("tk_rts_border")){$(this).addClass("tk_rts_border").siblings().removeClass("tk_rts_border"),$(this).siblings("li").find(".tk_rts_lt_cal").removeClass("tk_rts_lt_cal_on").addClass("tk_rts_lt_cal_off"),$(this).find(".tk_rts_lt_cal").addClass("tk_rts_lt_cal_on").removeClass("tk_rts_lt_cal_off");var t=$(this).attr("data-s"),s=$(this).attr("data-w"),_=$(this).attr("data-t");F_ChatResult_Info._getSessionDetail(s,t,_)}})})}else _.html("暂无数据")},function(t,s,i){_.html(B_Pre._empty(s))})},_getSessionDetail:function(t,s,_){var i={};i.topic_id=t,i.session_id=s,i.source_type=_,i=B_Common._postData(i),F_ChatResult_Info._getDetail($("#bs_topic_detail"),1,i,null,"topic")},_htmlSession:function(t,s,_){var i="";switch(s+""){case"0":i+='<li class="tk_rts_border" data-w="'+t.topic_id+'" data-s="'+t.session_id+'" data-t="'+_+'"><div class="tk_rts_lt_cal tk_top_img tk_rts_lt_cal_on">';break;default:i+='<li data-w="'+t.topic_id+'" data-s="'+t.session_id+'" data-t="'+_+'"><div class="tk_rts_lt_cal tk_top_img tk_rts_lt_cal_off">'}return i+="会话"+(s+1)+'</div><div class="tk_rts_lt_info"><span title="'+t.session_summary+'">'+t.session_summary+"</span>",i+="共"+t.user_num+"人参与，产生"+t.post_num+"条聊天记录</div></li>"},_htmlTopic:function(t,s){for(var _="",i=0;i<t.length;i++)_+=i%2==0?"<dl>                        <dt>【"+t[i].source.qq_id+"】 "+t[i].source.author+"   "+t[i].source.publish_time+'</dt>                        <dd>                            <i class="tk_top_img c_floatLeft mg_right"></i>                            <span class="c_floatLeft"><div class="ar_left tk_top_img"></div>'+t[i].source.content+'</span>                            <div class="clearfix"></div>                        </dd>                     </dl>':'<dl>                        <dt style="text-align: right">【'+t[i].source.qq_id+"】 "+t[i].source.author+"   "+t[i].source.publish_time+'</dt>                        <dd>                            <i class="tk_top_img c_floatRight mg_left"></i>                            <span class="c_floatRight"><div class="ar_right tk_top_img"></div>'+t[i].source.content+'</span>                            <div class="clearfix"></div>                        </dd>                    </dl>';return _+=s?'<div class="tk_rt_topic_man_more"><span>已显示全部</span></div>':'<div class="tk_rt_topic_man_more"><span>点击查看更多</span></div>'},_htmlDetail:function(t,s,_){for(var i="",a=0;a<t.length;a++)i+="<dl>                        <dt>"+t[a].source.publish_time+"</dt>                        <dd>"+B_Common._focusKeywords(_,t[a].source.content)+"</dd>                    </dl>";return i+=s?'<div class="tk_rt_topic_man_more"><span>已显示全部</span></div>':'<div class="tk_rt_topic_man_more"><span>点击查看更多</span></div>'}};